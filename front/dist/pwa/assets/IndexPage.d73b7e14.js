import{_ as Q,D as c,E as h,F as s,G as o,z as y,Q as u,ak as D,H as n,al as f,am as E,C as I,an as g,ao as A,ap as O,K as U,L as v,J as w,I as p,aq as R}from"./index.1b6eb933.js";import{Q as V,a as T}from"./QMarkupTable.f5b5739d.js";import{Q as C}from"./QTooltip.4fa5f93e.js";import{Q as k}from"./QItem.c5c3e815.js";import{Q as q}from"./QBtnDropdown.c13704e2.js";import{Q as M,a as m}from"./QTable.1ba86b2d.js";import{I as S,Q as F}from"./Imprimir.f441f32c.js";import{Q as B}from"./QPage.af41e2a4.js";import{C as x}from"./ClosePopup.158fbfa8.js";import{h as z}from"./html2pdf.ae477832.js";import{h as G}from"./moment.40bc58bf.js";import{C as Y}from"./CardComponent.23853704.js";import{Q as P}from"./QSpace.4d067a84.js";import{Q as L}from"./QForm.6a225d42.js";import{E as j}from"./Excel.d86693b0.js";import"./format.5fd81f0c.js";import"./QList.c712dba2.js";import"./_commonjsHelpers.d2428edb.js";const H={data(){return{provider:[],gasto:{monto:"",concepto:"",metodo:"EFECTIVO",client_id:""},loading:!1}},mounted(){this.proveedoresGet()},methods:{proveedoresGet(){this.$axios.get("proveedores").then(t=>{this.provider=t.data})},saveSale(){this.loading=!0,this.$axios.post("registrarGasto",this.gasto).then(t=>{this.$emit("gastoCreated",t.data),this.$alert.success("Gasto registrado")}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},proveedorCreateSimple(){this.$q.dialog({title:"Registrar proveedor",message:"Ingrese el nombre del proveedor",prompt:{model:"",type:"text"},cancel:!0,persistent:!0}).onOk(t=>{this.$axios.post("proveedorCreateSimple",{nombre:t}).then(e=>{this.provider.push(e.data),this.gasto.client_id=e.data.id}).catch(e=>{this.$alert.error(e.response.data.message)})})}}},W=n("div",{class:"text-subtitle2 text-bold text-grey"}," Registrar gasto ",-1),J={class:"row"},K={class:"col-12"},X={class:"col-12"},Z={class:"col-12"},$={class:"col-12"},ee={class:"col-12"};function oe(t,e,r,b,a,i){return c(),h(E,{style:{width:"500px","max-width":"80vw"}},{default:s(()=>[o(D,{class:"row items-center q-pb-none"},{default:s(()=>[W,o(P),y(o(u,{icon:"o_highlight_off",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),o(D,null,{default:s(()=>[o(L,{onSubmit:i.saveSale},{default:s(()=>[n("div",J,[n("div",K,[o(f,{outlined:"",dense:"",modelValue:a.gasto.monto,"onUpdate:modelValue":e[0]||(e[0]=d=>a.gasto.monto=d),label:"Monto *",type:"number",step:"0.1",rules:[d=>!!d||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",X,[o(f,{outlined:"",dense:"",hint:"",modelValue:a.gasto.concepto,"onUpdate:modelValue":e[1]||(e[1]=d=>a.gasto.concepto=d),label:"Descripci\xF3n"},null,8,["modelValue"])]),n("div",Z,[o(V,{outlined:"",dense:"",hint:"",modelValue:a.gasto.metodo,"onUpdate:modelValue":e[2]||(e[2]=d=>a.gasto.metodo=d),options:t.$metodos,label:"M\xE9todo de pago"},null,8,["modelValue","options"])]),n("div",$,[o(V,{outlined:"",dense:"",hint:"",modelValue:a.gasto.client_id,"onUpdate:modelValue":e[3]||(e[3]=d=>a.gasto.client_id=d),options:a.provider,label:"Proveedor","emit-value":"","map-options":"","option-value":"id","option-label":"nombre","use-input":""},{after:s(()=>[o(u,{flat:"",dense:"",icon:"add_circle_outline",onClick:i.proveedorCreateSimple,color:"green"},null,8,["onClick"])]),_:1},8,["modelValue","options"])]),n("div",ee,[o(u,{type:"submit",label:"Guardar",color:"red-7",class:"full-width","no-caps":"",rounded:"",loading:a.loading},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var te=Q(H,[["render",oe]]);const le={name:"IndexPage",components:{DialogGasto:te,CardComponent:Y},data(){return{gastoDialog:!1,fechaInicioSemana:G().startOf("isoWeek").format("YYYY-MM-DD"),fechaFinSemana:G().endOf("isoWeek").format("YYYY-MM-DD"),concepto:"",columns:[{name:"opcion",label:"Opcion",align:"left",field:"opcion"},{name:"proveedorcliente",label:"Proveedor / cliente",align:"left",field:"proveedor / cliente",sortable:!0},{name:"montoTotal",label:"Monto total",align:"left",field:"montoTotal",sortable:!0},{name:"fechayhora",label:"Fecha y hora",align:"left",field:"fechayhora",sortable:!0},{name:"concepto",label:"Concepto",align:"left",field:"concepto",sortable:!0},{name:"comentario",label:"Comentario",align:"left",field:"comentario",sortable:!0},{name:"egresoingreso",label:"Egreso / ingreso",align:"left",field:"egreso / ingreso",sortable:!0},{name:"user",label:"Usuario",align:"left",field:t=>t.user.name,sortable:!0},{name:"lugar",label:"lugar",align:"left",field:t=>t.user.lugar,sortable:!0}],sales:[],loading:!1,filter:"",users:[],user:0}},mounted(){this.usersGet(),this.salesGet()},methods:{usersGet(){this.users=[{label:"Todos",value:0}],this.$axios.get("usuarios").then(t=>{t.data.forEach(e=>{this.users.push({label:e.name,value:e.id})})}).catch(t=>{console.log(t)})},exportar(){const t=[{sheet:"Adults",columns:[{label:"Proveedor / cliente",value:"name"},{label:"Monto total",value:"total"},{label:"Fecha y hora",value:"fecha_emision"},{label:"Concepto",value:"concepto"},{label:"Comentario",value:"comentario"},{label:"Egreso / ingreso",value:"tipo_venta"},{label:"Usuario",value:"user.name"},{label:"Lugar",value:"lugar"}],content:this.sales}];j.export(t,"ventas")},reimprimirNota(t){S.nota(t).then(e=>{})},descargarDpf(t){document.getElementById("myElement").classList.remove("hidden"),S.nota(t,!1).then(r=>{const b=document.getElementById("myElement"),a={margin:1,filename:t.concepto+".pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"portrait"}};z().set(a).from(b).save(),setTimeout(()=>{b.classList.add("hidden")},300)})},saleAnular(t){this.$q.dialog({title:"Anular venta",message:"\xBFEst\xE1 seguro de anular la venta?",persistent:!0,ok:{label:"Si",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(()=>{this.$axios.post("saleAnular",{id:t}).then(e=>{this.salesGet()}).catch(e=>{console.log(e)})})},gastoCreated(t){this.sales.unshift(t),this.gastoDialog=!1},salesGet(){this.loading=!0,this.$axios.get("sales",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto,user:this.user}}).then(t=>{this.sales=t.data,console.log(t.data)}).catch(t=>{console.log(t)}).finally(()=>{this.loading=!1})}},computed:{balance(){const t=this.sales.reduce((e,r)=>r.estado!=="ANULADO"?r.tipo_venta==="INGRESO"?e+r.total:e-r.total:e,0);return Math.round(t*100)/100},ingreso(){const t=this.sales.reduce((e,r)=>r.tipo_venta==="INGRESO"&&r.estado!=="ANULADO"?e+r.total:e,0);return Math.round(t*100)/100},gasto(){const t=this.sales.reduce((e,r)=>r.tipo_venta==="EGRESO"&&r.estado!=="ANULADO"?e+r.total:e,0);return Math.round(t*100)/100}}},ae={class:"row"},se={class:"col-6 col-md-2 q-pa-xs"},ne={class:"col-6 col-md-2 q-pa-xs"},re={class:"col-12 col-md-2 q-pa-xs"},ie={class:"col-12 col-md-2 q-pa-xs"},de={class:"col-12 col-md-1 text-right"},ce={class:"col-12 col-md-3 text-right"},ue={key:0,class:"col-12 col-md-4 q-pa-xs"},me={key:1,class:"col-12 col-md-4 q-pa-xs"},pe={key:2,class:"col-12 col-md-4 q-pa-xs"},ge={class:"col-12"},he={key:1},fe={key:0,class:"text-grey"},_e={class:"text-grey"},ve={style:{"padding-left":"15px"}},be={class:"q-ml-xs",style:{width:"300px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},we={class:"",style:{width:"300px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},ye=n("div",{id:"myElement",class:"hidden"},null,-1);function xe(t,e,r,b,a,i){const d=I("CardComponent"),N=I("DialogGasto");return c(),g(O,null,[o(B,{class:"q-pa-xs bg-grey-3"},{default:s(()=>[n("div",ae,[n("div",se,[o(f,{modelValue:a.fechaInicioSemana,"onUpdate:modelValue":[e[0]||(e[0]=l=>a.fechaInicioSemana=l),i.salesGet],label:"Fecha inicio",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",ne,[o(f,{modelValue:a.fechaFinSemana,"onUpdate:modelValue":[e[1]||(e[1]=l=>a.fechaFinSemana=l),i.salesGet],label:"Fecha fin",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",re,[o(f,{modelValue:a.concepto,"onUpdate:modelValue":[e[2]||(e[2]=l=>a.concepto=l),i.salesGet],label:"Buscar por concepto",dense:"",outlined:"",class:"bg-white",debounce:"300",clearable:"",placeholder:"Buscar por concepto"},{prepend:s(()=>[o(U,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),n("div",ie,[t.$store.user.type=="ADMINISTRADOR"?(c(),h(V,{key:0,modelValue:a.user,"onUpdate:modelValue":[e[3]||(e[3]=l=>a.user=l),i.salesGet],label:"Usuario",dense:"",outlined:"",class:"bg-white",options:a.users,"map-options":"","emit-value":""},null,8,["modelValue","options","onUpdate:modelValue"])):v("",!0)]),n("div",de,[o(u,{class:"",flat:"",dense:"",label:"Exportar",color:"primary",icon:"get_app","no-caps":"",rounded:"",onClick:i.exportar,size:"10px"},null,8,["onClick"])]),n("div",ce,[o(u,{dense:"",label:"Nuevo Venta",color:"green",icon:"add_circle_outline","no-caps":"",rounded:"",to:"/sale"}),o(u,{dense:"",label:"Nuevo Gasto",color:"red",icon:"add_circle_outline","no-caps":"",rounded:"",onClick:e[4]||(e[4]=l=>a.gastoDialog=!0)})]),t.$store.user.type=="ADMINISTRADOR"?(c(),g("div",ue,[o(d,{monto:i.balance,color:"grey",title:"Balance",icono:"o_trending_up"},null,8,["monto"])])):v("",!0),t.$store.user.type=="ADMINISTRADOR"?(c(),g("div",me,[o(d,{monto:i.ingreso,color:"green",title:"Ventas",icono:"o_trending_up"},null,8,["monto"])])):v("",!0),t.$store.user.type=="ADMINISTRADOR"?(c(),g("div",pe,[o(d,{monto:i.gasto,color:"red",title:"Gastos",icono:"o_trending_down"},null,8,["monto"])])):v("",!0),n("div",ge,[o(M,{columns:a.columns,rows:a.sales,dense:"","rows-per-page-options":[0],filter:a.filter,loading:a.loading,"wrap-cells":"","no-data-label":"No hay ventas","no-results-label":"No hay ventas"},{"top-right":s(()=>[o(f,{outlined:"",modelValue:a.filter,"onUpdate:modelValue":e[5]||(e[5]=l=>a.filter=l),debounce:"300",placeholder:"Buscar",dense:""},{append:s(()=>[o(u,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue"])]),body:s(l=>[o(F,{props:l},{default:s(()=>[o(m,{key:"opcion",props:l,"auto-width":""},{default:s(()=>[l.row.estado=="ACTIVO"?(c(),h(q,{key:0,dense:"",icon:"more_vert",align:"right",label:"Opciones","no-caps":"",color:l.row.tipo_venta=="INGRESO"?"green-9":"red-9",size:"10px"},{default:s(()=>[y((c(),h(k,{clickable:"",class:"text-center"},{default:s(()=>[o(u,{dense:"",label:"Anular",color:"red-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"o_highlight_off",onClick:_=>i.saleAnular(l.row.id)},{default:s(()=>[o(C,null,{default:s(()=>[w("Anular venta")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[x]]),y((c(),h(k,{clickable:"",class:"text-center"},{default:s(()=>[o(u,{dense:"",label:"Imprimir",color:"green-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"print",onClick:_=>i.reimprimirNota(l.row)},{default:s(()=>[o(C,null,{default:s(()=>[w("Imprimir nota")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[x]]),y((c(),h(k,{clickable:"",class:"text-center"},{default:s(()=>[o(u,{dense:"",label:"Descargar",color:"blue-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"get_app",onClick:_=>i.descargarDpf(l.row)},{default:s(()=>[o(C,null,{default:s(()=>[w("Descargar nota")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[x]])]),_:2},1032,["color"])):(c(),g("div",he,[o(u,{dense:"",label:"Anulado",color:"grey-4",size:"10px","no-caps":"","no-wrap":"",icon:"o_highlight_off"})]))]),_:2},1032,["props"]),o(m,{key:"proveedorcliente",props:l},{default:s(()=>[l.row.client?(c(),g("div",fe,p(l.row.name==null?l.row.client.id==28?"SN":l.row.client.nombre:l.row.name),1)):v("",!0)]),_:2},1032,["props"]),o(m,{key:"montoTotal",props:l},{default:s(()=>[n("span",_e,p(l.row.total)+" Bs",1)]),_:2},1032,["props"]),o(m,{key:"fechayhora",props:l,style:{"min-width":"150px"}},{default:s(()=>[w(p(t.$filters.dateDmYHis(l.row.fecha_emision)),1)]),_:2},1032,["props"]),o(m,{key:"concepto",props:l,class:""},{default:s(()=>[n("div",null,[o(u,{icon:"o_local_atm",size:"15px",color:`${l.row.tipo_venta=="INGRESO"?"green":"red"}-7`,class:R(`bg-${l.row.tipo_venta=="INGRESO"?"green":"red"}-2`),dense:"",flat:"",style:{padding:"0px",margin:"0px","border-radius":"0px",position:"absolute",top:"5px",left:"0px"}},null,8,["color","class"]),n("div",ve,[n("div",be,p(l.row.concepto),1)])])]),_:2},1032,["props"]),o(m,{key:"comentario",props:l},{default:s(()=>[n("div",we,p(l.row.comentario),1)]),_:2},1032,["props"]),o(m,{key:"egresoingreso",props:l},{default:s(()=>[o(T,{color:`${l.row.tipo_venta=="INGRESO"?"green":"red"}-5`,"text-color":"white",dense:"",flat:"",label:l.row.tipo_venta},null,8,["color","label"])]),_:2},1032,["props"]),o(m,{key:"user",props:l},{default:s(()=>{var _;return[n("p",null,p((_=l.row.user)==null?void 0:_.name),1)]}),_:2},1032,["props"]),o(m,{key:"lugar",props:l},{default:s(()=>[n("p",null,p(l.row.lugar),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["columns","rows","filter","loading"])])])]),_:1}),o(A,{modelValue:a.gastoDialog,"onUpdate:modelValue":e[6]||(e[6]=l=>a.gastoDialog=l),position:"right",maximized:""},{default:s(()=>[o(N,{onGastoCreated:i.gastoCreated},null,8,["onGastoCreated"])]),_:1},8,["modelValue"]),ye],64)}var Be=Q(le,[["render",xe]]);export{Be as default};
