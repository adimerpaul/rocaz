import{_ as E,D as c,E as f,F as a,G as t,z as y,Q as u,an as I,H as n,ao as _,ap as Q,C as D,aq as p,ar as R,as as U,K as M,L as h,J as b,I as g,at as S}from"./index.179eaeb9.js";import{Q as V}from"./QMarkupTable.8947dba4.js";import{Q as k}from"./QTooltip.ff026b8d.js";import{Q as C}from"./QItem.18ddfb1b.js";import{Q as T}from"./QBtnDropdown.e40cabc6.js";import{Q as q,a as m}from"./QTable.c3059a1f.js";import{Q as G}from"./format.3c0ab256.js";import{I as N,Q as F}from"./Imprimir.856db61b.js";import{Q as B}from"./QPage.ad02aa04.js";import{C as x}from"./ClosePopup.f76b3fda.js";import{h as z}from"./html2pdf.09218e56.js";import{h as A}from"./moment.40bc58bf.js";import{C as Y}from"./CardComponent.5d7e719d.js";import{Q as L}from"./QSpace.0fc2fccc.js";import{Q as P}from"./QForm.fed73c83.js";import{E as $}from"./Excel.d86693b0.js";import"./QList.15341957.js";import"./_commonjsHelpers.d2428edb.js";const j={data(){return{provider:[],gasto:{monto:"",concepto:"",metodo:"EFECTIVO",client_id:""},loading:!1}},mounted(){this.proveedoresGet()},methods:{proveedoresGet(){this.$axios.get("proveedores").then(l=>{this.provider=l.data})},saveSale(){this.loading=!0,this.$axios.post("registrarGasto",this.gasto).then(l=>{this.$emit("gastoCreated",l.data),this.$alert.success("Gasto registrado")}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},proveedorCreateSimple(){this.$q.dialog({title:"Registrar proveedor",message:"Ingrese el nombre del proveedor",prompt:{model:"",type:"text"},cancel:!0,persistent:!0}).onOk(l=>{this.$axios.post("proveedorCreateSimple",{nombre:l}).then(e=>{this.provider.push(e.data),this.gasto.client_id=e.data.id}).catch(e=>{this.$alert.error(e.response.data.message)})})}}},H=n("div",{class:"text-subtitle2 text-bold text-grey"}," Registrar gasto ",-1),W={class:"row"},J={class:"col-12"},K={class:"col-12"},X={class:"col-12"},Z={class:"col-12"},ee={class:"col-12"};function oe(l,e,i,w,s,r){return c(),f(Q,{style:{width:"500px","max-width":"80vw"}},{default:a(()=>[t(I,{class:"row items-center q-pb-none"},{default:a(()=>[H,t(L),y(t(u,{icon:"o_highlight_off",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),t(I,null,{default:a(()=>[t(P,{onSubmit:r.saveSale},{default:a(()=>[n("div",W,[n("div",J,[t(_,{outlined:"",dense:"",modelValue:s.gasto.monto,"onUpdate:modelValue":e[0]||(e[0]=d=>s.gasto.monto=d),label:"Monto *",type:"number",step:"0.1",rules:[d=>!!d||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",K,[t(_,{outlined:"",dense:"",hint:"",modelValue:s.gasto.concepto,"onUpdate:modelValue":e[1]||(e[1]=d=>s.gasto.concepto=d),label:"Descripci\xF3n"},null,8,["modelValue"])]),n("div",X,[t(V,{outlined:"",dense:"",hint:"",modelValue:s.gasto.metodo,"onUpdate:modelValue":e[2]||(e[2]=d=>s.gasto.metodo=d),options:l.$metodos,label:"M\xE9todo de pago"},null,8,["modelValue","options"])]),n("div",Z,[t(V,{outlined:"",dense:"",hint:"",modelValue:s.gasto.client_id,"onUpdate:modelValue":e[3]||(e[3]=d=>s.gasto.client_id=d),options:s.provider,label:"Proveedor","emit-value":"","map-options":"","option-value":"id","option-label":"nombre","use-input":""},{after:a(()=>[t(u,{flat:"",dense:"",icon:"add_circle_outline",onClick:r.proveedorCreateSimple,color:"green"},null,8,["onClick"])]),_:1},8,["modelValue","options"])]),n("div",ee,[t(u,{type:"submit",label:"Guardar",color:"red-7",class:"full-width","no-caps":"",rounded:"",loading:s.loading},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var te=E(j,[["render",oe]]);const le={name:"IndexPage",components:{DialogGasto:te,CardComponent:Y},data(){return{gastoDialog:!1,fechaInicioSemana:A().startOf("isoWeek").format("YYYY-MM-DD"),fechaFinSemana:A().endOf("isoWeek").format("YYYY-MM-DD"),concepto:"",columns:[{name:"opcion",label:"Opcion",align:"left",field:"opcion"},{name:"proveedorcliente",label:"Proveedor / cliente",align:"left",field:"proveedor / cliente",sortable:!0},{name:"montoTotal",label:"Monto total",align:"left",field:"montoTotal",sortable:!0},{name:"fechayhora",label:"Fecha y hora",align:"left",field:"fechayhora",sortable:!0},{name:"concepto",label:"Concepto",align:"left",field:"concepto",sortable:!0},{name:"comentario",label:"Comentario",align:"left",field:"comentario",sortable:!0},{name:"egresoingreso",label:"Egreso / ingreso",align:"left",field:"egreso / ingreso",sortable:!0},{name:"metodo",label:"Metodo",align:"left",field:"metodo",sortable:!0},{name:"user",label:"Usuario",align:"left",field:l=>l.user.name,sortable:!0},{name:"lugar",label:"lugar",align:"left",field:l=>l.user.lugar,sortable:!0}],sales:[],loading:!1,filter:"",users:[],user:0}},mounted(){this.usersGet(),this.salesGet()},methods:{usersGet(){this.users=[{label:"Todos",value:0}],this.$axios.get("usuarios").then(l=>{l.data.forEach(e=>{this.users.push({label:e.name,value:e.id})})}).catch(l=>{console.log(l)})},exportar(){const l=[{sheet:"Adults",columns:[{label:"Proveedor / cliente",value:"name"},{label:"Monto total",value:"total"},{label:"Fecha y hora",value:"fecha_emision"},{label:"Concepto",value:"concepto"},{label:"Comentario",value:"comentario"},{label:"Egreso / ingreso",value:"tipo_venta"},{label:"Usuario",value:"user.name"},{label:"Lugar",value:"lugar"}],content:this.sales}];$.export(l,"ventas")},reimprimirNota(l){N.nota(l).then(e=>{})},descargarDpf(l){document.getElementById("myElement").classList.remove("hidden"),N.nota(l,!1).then(i=>{const w=document.getElementById("myElement"),s={margin:1,filename:l.concepto+".pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"portrait"}};z().set(s).from(w).save(),setTimeout(()=>{w.classList.add("hidden")},300)})},saleAnular(l){this.$q.dialog({title:"Anular venta",message:"\xBFEst\xE1 seguro de anular la venta?",persistent:!0,ok:{label:"Si",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(()=>{this.$axios.post("saleAnular",{id:l}).then(e=>{this.salesGet()}).catch(e=>{console.log(e)})})},gastoCreated(l){this.sales.unshift(l),this.gastoDialog=!1},salesGet(l="todo"){this.loading=!0,this.$axios.get("sales",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto,user:this.user,type:l}}).then(e=>{this.sales=e.data,console.log(e.data)}).catch(e=>{console.log(e)}).finally(()=>{this.loading=!1})}},computed:{ganancia(){const l=this.sales.reduce((e,i)=>i.tipo_venta==="INGRESO"&&i.estado!=="ANULADO"?e+i.ganancia:e,0);return Math.round(l*100)/100},balance(){const l=this.sales.reduce((e,i)=>i.estado!=="ANULADO"?i.tipo_venta==="INGRESO"?e+i.total:e-i.total:e,0);return Math.round(l*100)/100},ingreso(){const l=this.sales.reduce((e,i)=>i.tipo_venta==="INGRESO"&&i.estado!=="ANULADO"?e+i.total:e,0);return Math.round(l*100)/100},gasto(){const l=this.sales.reduce((e,i)=>i.tipo_venta==="EGRESO"&&i.estado!=="ANULADO"?e+i.total:e,0);return Math.round(l*100)/100}}},ae={class:"row"},se={class:"col-6 col-md-2 q-pa-xs"},ne={class:"col-6 col-md-2 q-pa-xs"},re={class:"col-12 col-md-2 q-pa-xs"},ie={class:"col-12 col-md-2 q-pa-xs"},de={class:"col-12 col-md-1 text-right"},ce={class:"col-12 col-md-3 text-right"},ue={key:0,class:"col-12 col-md-3 q-pa-xs"},me={key:1,class:"col-12 col-md-3 q-pa-xs"},pe={key:2,class:"col-12 col-md-3 q-pa-xs"},ge={key:3,class:"col-12 col-md-3 q-pa-xs"},he={class:"col-12"},fe={key:1},_e={key:0,class:"text-grey"},ve={class:"text-grey"},be={key:0},we={style:{"padding-left":"15px"}},ye={class:"q-ml-xs",style:{width:"200px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},xe={class:"",style:{width:"200px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},ke=n("div",{id:"myElement",class:"hidden"},null,-1);function Ce(l,e,i,w,s,r){const d=D("CardComponent"),O=D("DialogGasto");return c(),p(U,null,[t(B,{class:"q-pa-xs bg-grey-3"},{default:a(()=>[n("div",ae,[n("div",se,[t(_,{modelValue:s.fechaInicioSemana,"onUpdate:modelValue":[e[0]||(e[0]=o=>s.fechaInicioSemana=o),r.salesGet],label:"Fecha inicio",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",ne,[t(_,{modelValue:s.fechaFinSemana,"onUpdate:modelValue":[e[1]||(e[1]=o=>s.fechaFinSemana=o),r.salesGet],label:"Fecha fin",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",re,[t(_,{modelValue:s.concepto,"onUpdate:modelValue":[e[2]||(e[2]=o=>s.concepto=o),r.salesGet],label:"Buscar por concepto",dense:"",outlined:"",class:"bg-white",debounce:"300",clearable:"",placeholder:"Buscar por concepto"},{prepend:a(()=>[t(M,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),n("div",ie,[l.$store.user.type=="ADMINISTRADOR"?(c(),f(V,{key:0,modelValue:s.user,"onUpdate:modelValue":[e[3]||(e[3]=o=>s.user=o),r.salesGet],label:"Usuario",dense:"",outlined:"",class:"bg-white",options:s.users,"map-options":"","emit-value":""},null,8,["modelValue","options","onUpdate:modelValue"])):h("",!0)]),n("div",de,[t(u,{class:"",flat:"",dense:"",label:"Exportar",color:"primary",icon:"get_app","no-caps":"",rounded:"",onClick:r.exportar,size:"10px"},null,8,["onClick"])]),n("div",ce,[t(u,{dense:"",label:"Nuevo Venta",color:"green",icon:"add_circle_outline","no-caps":"",rounded:"",to:"/sale"}),t(u,{dense:"",label:"Nuevo Gasto",color:"red",icon:"add_circle_outline","no-caps":"",rounded:"",onClick:e[4]||(e[4]=o=>s.gastoDialog=!0)})]),l.$store.user.type=="ADMINISTRADOR"?(c(),p("div",ue,[t(d,{class:"cursor-pointer",monto:r.ganancia,color:"blue",title:"Ganancia",icono:"o_trending_up",onClick:e[5]||(e[5]=o=>r.salesGet("todo"))},null,8,["monto"])])):h("",!0),l.$store.user.type=="ADMINISTRADOR"?(c(),p("div",me,[t(d,{class:"cursor-pointer",monto:r.balance,color:"grey",title:"Balance",icono:"o_trending_up",onClick:e[6]||(e[6]=o=>r.salesGet("todo"))},null,8,["monto"])])):h("",!0),l.$store.user.type=="ADMINISTRADOR"?(c(),p("div",pe,[t(d,{class:"cursor-pointer",monto:r.ingreso,color:"green",title:"Ventas",icono:"o_trending_up",onClick:e[7]||(e[7]=o=>r.salesGet("ingreso"))},null,8,["monto"])])):h("",!0),l.$store.user.type=="ADMINISTRADOR"?(c(),p("div",ge,[t(d,{class:"cursor-pointer",monto:r.gasto,color:"red",title:"Gastos",icono:"o_trending_down",onClick:e[8]||(e[8]=o=>r.salesGet("egreso"))},null,8,["monto"])])):h("",!0),n("div",he,[t(q,{columns:s.columns,rows:s.sales,dense:"","rows-per-page-options":[0],filter:s.filter,loading:s.loading,"wrap-cells":"","no-data-label":"No hay ventas","no-results-label":"No hay ventas"},{"top-right":a(()=>[t(_,{outlined:"",modelValue:s.filter,"onUpdate:modelValue":e[9]||(e[9]=o=>s.filter=o),debounce:"300",placeholder:"Buscar",dense:""},{append:a(()=>[t(u,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue"])]),body:a(o=>[t(F,{props:o},{default:a(()=>[t(m,{key:"opcion",props:o,"auto-width":""},{default:a(()=>[o.row.estado=="ACTIVO"?(c(),f(T,{key:0,dense:"",icon:"more_vert",align:"right",label:"Opciones","no-caps":"",color:o.row.tipo_venta=="INGRESO"?"green-9":"red-9",size:"10px"},{default:a(()=>[y((c(),f(C,{clickable:"",class:"text-center"},{default:a(()=>[t(u,{dense:"",label:"Anular",color:"red-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"o_highlight_off",onClick:v=>r.saleAnular(o.row.id)},{default:a(()=>[t(k,null,{default:a(()=>[b("Anular venta")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[x]]),y((c(),f(C,{clickable:"",class:"text-center"},{default:a(()=>[t(u,{dense:"",label:"Imprimir",color:"green-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"print",onClick:v=>r.reimprimirNota(o.row)},{default:a(()=>[t(k,null,{default:a(()=>[b("Imprimir nota")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[x]]),y((c(),f(C,{clickable:"",class:"text-center"},{default:a(()=>[t(u,{dense:"",label:"Descargar",color:"blue-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"get_app",onClick:v=>r.descargarDpf(o.row)},{default:a(()=>[t(k,null,{default:a(()=>[b("Descargar nota")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[x]])]),_:2},1032,["color"])):(c(),p("div",fe,[t(u,{dense:"",label:"Anulado",color:"grey-4",size:"10px","no-caps":"","no-wrap":"",icon:"o_highlight_off"})]))]),_:2},1032,["props"]),t(m,{key:"proveedorcliente",props:o},{default:a(()=>[o.row.client?(c(),p("div",_e,g(o.row.name==null?o.row.client.id==28?"SN":o.row.client.nombre:o.row.name),1)):h("",!0)]),_:2},1032,["props"]),t(m,{key:"montoTotal",props:o},{default:a(()=>[n("span",ve,g(o.row.total)+" Bs",1),l.$store.user.type=="ADMINISTRADOR"?(c(),p("span",be,[b(" -"),n("span",{class:S(`text-${o.row.tipo_venta=="INGRESO"?"green":"red"}`)},g(o.row.ganancia)+" Bs",3)])):h("",!0)]),_:2},1032,["props"]),t(m,{key:"fechayhora",props:o,style:{"min-width":"150px"}},{default:a(()=>[b(g(l.$filters.dateDmYHis(o.row.fecha_emision)),1)]),_:2},1032,["props"]),t(m,{key:"concepto",props:o,class:""},{default:a(()=>[n("div",null,[t(u,{icon:"o_local_atm",size:"15px",color:`${o.row.tipo_venta=="INGRESO"?"green":"red"}-7`,class:S(`bg-${o.row.tipo_venta=="INGRESO"?"green":"red"}-2`),dense:"",flat:"",style:{padding:"0px",margin:"0px","border-radius":"0px",position:"absolute",top:"5px",left:"0px"}},null,8,["color","class"]),n("div",we,[n("div",ye,g(o.row.concepto),1)])])]),_:2},1032,["props"]),t(m,{key:"comentario",props:o},{default:a(()=>[n("div",xe,g(o.row.comentario),1)]),_:2},1032,["props"]),t(m,{key:"egresoingreso",props:o},{default:a(()=>[t(G,{color:`${o.row.tipo_venta=="INGRESO"?"green":"red"}-5`,"text-color":"white",dense:"",flat:"",label:o.row.tipo_venta},null,8,["color","label"])]),_:2},1032,["props"]),t(m,{key:"metodo",props:o},{default:a(()=>[t(G,{color:`${o.row.metodo=="EFECTIVO"?"blue":"orange"}-5`,"text-color":"white",dense:"",flat:"",label:o.row.metodo},null,8,["color","label"])]),_:2},1032,["props"]),t(m,{key:"user",props:o},{default:a(()=>{var v;return[n("p",null,g((v=o.row.user)==null?void 0:v.name),1)]}),_:2},1032,["props"]),t(m,{key:"lugar",props:o},{default:a(()=>[n("p",null,g(o.row.lugar),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["columns","rows","filter","loading"])])])]),_:1}),t(R,{modelValue:s.gastoDialog,"onUpdate:modelValue":e[10]||(e[10]=o=>s.gastoDialog=o),position:"right",maximized:""},{default:a(()=>[t(O,{onGastoCreated:r.gastoCreated},null,8,["onGastoCreated"])]),_:1},8,["modelValue"]),ke],64)}var Ye=E(le,[["render",Ce]]);export{Ye as default};
