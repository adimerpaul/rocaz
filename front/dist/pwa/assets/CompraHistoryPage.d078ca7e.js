import{_ as k,C,D as i,am as f,G as l,F as t,ao as I,H as n,ak as p,K as Q,Q as r,E as h,z as _,J as b,aq as V,I as u,ap as A}from"./index.c1bda583.js";import{Q as y}from"./QTooltip.bff1a600.js";import{Q as v}from"./QItem.4067e6bd.js";import{Q as N}from"./QBtnDropdown.a53af9f5.js";import{Q as S,a as c}from"./QTable.98f63700.js";import{I as D,Q as O}from"./Imprimir.97a2007c.js";import{Q as B}from"./QPage.c78bbd12.js";import{C as w}from"./ClosePopup.cc88c787.js";import{h as x}from"./moment.40bc58bf.js";import{C as E}from"./CardComponent.834de03a.js";import"./format.f4c59c6f.js";import"./QSelect.02481b4d.js";import"./QList.2afee3d5.js";const F={name:"CompraHistoryPage",components:{CardComponent:E},data(){return{gastoDialog:!1,fechaInicioSemana:x().startOf("isoWeek").format("YYYY-MM-DD"),fechaFinSemana:x().endOf("isoWeek").format("YYYY-MM-DD"),concepto:"",columns:[{name:"opcion",label:"Opcion",align:"left",field:"opcion"},{name:"concepto",label:"Concepto",align:"left",field:"concepto",sortable:!0},{name:"montoTotal",label:"Monto total",align:"left",field:"montoTotal",sortable:!0},{name:"proveedorcliente",label:"Proveedor / cliente",align:"left",field:"proveedor / cliente",sortable:!0},{name:"fechayhora",label:"Fecha y hora",align:"left",field:"fechayhora",sortable:!0},{name:"user",label:"Usuario",align:"left",field:o=>o.user.name,sortable:!0}],buys:[],loading:!1,filter:""}},mounted(){this.buyGet()},methods:{reimprimirNota(o){D.notaCompra(o)},buyAnular(o){this.$q.dialog({title:"Anular venta",message:"\xBFEst\xE1 seguro de anular la venta?",persistent:!0,ok:{label:"Si",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(()=>{this.$axios.post("buyAnular",{id:o}).then(a=>{this.buyGet()}).catch(a=>{console.log(a)})})},gastoCreated(o){this.buy.unshift(o),this.gastoDialog=!1},buyGet(){this.loading=!0,this.$axios.get("buys",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto}}).then(o=>{this.buys=o.data,console.log(o.data)}).catch(o=>{console.log(o)}).finally(()=>{this.loading=!1})}},computed:{balance(){let o=0;return this.buys.forEach(a=>{a.estado!=="ANULADO"&&(o+=a.total)}),Math.round(o*100)/100},cantidad(){let o=0;return this.buys.forEach(a=>{a.estado!=="ANULADO"&&(o+=1)}),Math.round(o*100)/100},ingreso(){return this.buys.reduce((o,a)=>a.tipo_venta==="INGRESO"&&a.estado!=="ANULADO"?o+a.total:o,0)},gasto(){return this.buys.reduce((o,a)=>a.tipo_venta==="EGRESO"&&a.estado!=="ANULADO"?o+a.total:o,0)}}},G={class:"row"},q={class:"col-6 col-md-2 q-pa-xs"},T={class:"col-6 col-md-2 q-pa-xs"},U={class:"col-12 col-md-3 q-pa-xs"},Y={class:"col-12 col-md-5 flex flex-center"},z={class:"col-12 col-md-6 q-pa-xs"},M={class:"col-12 col-md-6 q-pa-xs"},P={class:"col-12"},H={key:1},L={style:{"padding-left":"15px"}},R={class:"text-grey q-ml-xs",style:{width:"400px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},W={class:"text-grey"},J={key:0,class:"text-grey"},K=n("div",{id:"myElement",class:"hidden"},null,-1);function j(o,a,X,Z,s,d){const g=C("CardComponent");return i(),f(I,null,[l(B,{class:"q-pa-xs bg-grey-3"},{default:t(()=>[n("div",G,[n("div",q,[l(p,{modelValue:s.fechaInicioSemana,"onUpdate:modelValue":a[0]||(a[0]=e=>s.fechaInicioSemana=e),label:"Fecha inicio",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue"])]),n("div",T,[l(p,{modelValue:s.fechaFinSemana,"onUpdate:modelValue":a[1]||(a[1]=e=>s.fechaFinSemana=e),label:"Fecha fin",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue"])]),n("div",U,[l(p,{modelValue:s.concepto,"onUpdate:modelValue":a[2]||(a[2]=e=>s.concepto=e),label:"Buscar por concepto",dense:"",outlined:"",class:"bg-white",debounce:"300",clearable:"",placeholder:"Buscar por concepto"},{prepend:t(()=>[l(Q,{name:"search"})]),_:1},8,["modelValue"])]),n("div",Y,[l(r,{label:"Buscar",color:"primary",onClick:d.buyGet,class:"full-width",icon:"search","no-caps":"",loading:s.loading},null,8,["onClick","loading"])]),n("div",z,[l(g,{monto:d.cantidad,color:"grey",title:"Cantidad",icono:"o_trending_up"},null,8,["monto"])]),n("div",M,[l(g,{monto:d.balance,color:"green",title:"Gastos",icono:"o_trending_up"},null,8,["monto"])]),n("div",P,[l(S,{columns:s.columns,rows:s.buys,dense:"","rows-per-page-options":[0],filter:s.filter,loading:s.loading,"wrap-cells":"","no-data-label":"No hay ventas","no-results-label":"No hay ventas"},{"top-right":t(()=>[l(p,{outlined:"",modelValue:s.filter,"onUpdate:modelValue":a[3]||(a[3]=e=>s.filter=e),debounce:"300",placeholder:"Buscar",dense:""},{append:t(()=>[l(r,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue"])]),body:t(e=>[l(O,{props:e},{default:t(()=>[l(c,{key:"opcion",props:e,"auto-width":""},{default:t(()=>[e.row.estado=="ACTIVO"?(i(),h(N,{key:0,dense:"",icon:"more_vert",align:"right",label:"Opciones","no-caps":"",color:"primary",size:"10px"},{default:t(()=>[_((i(),h(v,{clickable:"",class:"text-center"},{default:t(()=>[l(r,{dense:"",label:"Anular",color:"red-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"o_highlight_off",onClick:m=>d.buyAnular(e.row.id)},{default:t(()=>[l(y,null,{default:t(()=>[b("Anular venta")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[w]]),_((i(),h(v,{clickable:"",class:"text-center"},{default:t(()=>[l(r,{dense:"",label:"Imprimir",color:"green-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"print",onClick:m=>d.reimprimirNota(e.row)},{default:t(()=>[l(y,null,{default:t(()=>[b("Imprimir nota")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[w]])]),_:2},1024)):(i(),f("div",H,[l(r,{dense:"",label:"Anulado",color:"grey-4",size:"10px","no-caps":"","no-wrap":"",icon:"o_highlight_off"})]))]),_:2},1032,["props"]),l(c,{key:"concepto",props:e,class:""},{default:t(()=>[n("div",null,[l(r,{icon:"o_local_atm",size:"15px",color:`${e.row.tipo_venta=="INGRESO"?"green":"red"}-7`,class:V(`bg-${e.row.tipo_venta=="INGRESO"?"green":"red"}-2`),dense:"",flat:"",style:{padding:"0px",margin:"0px","border-radius":"0px",position:"absolute",top:"5px",left:"0px"}},null,8,["color","class"]),n("div",L,[n("div",R,u(e.row.observacion),1)])])]),_:2},1032,["props"]),l(c,{key:"montoTotal",props:e},{default:t(()=>[n("span",W,u(e.row.total)+" Bs",1)]),_:2},1032,["props"]),l(c,{key:"proveedorcliente",props:e},{default:t(()=>[e.row.client?(i(),f("div",J,u(e.row.client.nombre),1)):A("",!0)]),_:2},1032,["props"]),l(c,{key:"fechayhora",props:e},{default:t(()=>[n("p",null,u(o.$filters.dateDmYHis(e.row.fecha+" "+e.row.hora)),1)]),_:2},1032,["props"]),l(c,{key:"user",props:e},{default:t(()=>{var m;return[n("p",null,u((m=e.row.user)==null?void 0:m.name),1)]}),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["columns","rows","filter","loading"])])])]),_:1}),K],64)}var me=k(F,[["render",j]]);export{me as default};
