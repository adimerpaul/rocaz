import{_ as x,D as m,E as w,F as s,G as o,z as S,Q as d,aj as f,H as n,ak as p,al as k,C as _,am as h,an as G,ao as Q,K as D,I,ap as N,J as u,aq as O}from"./index.5403af7c.js";import{Q as U}from"./QTooltip.34391ad2.js";import{Q as A}from"./QBtnGroup.0f6a6085.js";import{Q as q,a as c}from"./QTable.5b123952.js";import{Q as E,a as v,b as F}from"./QSpace.9739ab42.js";import{Q as B}from"./QTr.4dafa780.js";import{Q as T,a as Y}from"./QForm.14ea203f.js";import{h as b}from"./moment.40bc58bf.js";import{c as R}from"./CardComponent.ffd519a5.js";import{C as M}from"./ClosePopup.f1547ceb.js";import"./format.0be963f0.js";import"./QList.7480af51.js";const z={data(){return{provider:[],gasto:{monto:"",concepto:"",metodo:"EFECTIVO",client_id:""},loading:!1}},mounted(){this.proveedoresGet()},methods:{proveedoresGet(){this.$axios.get("proveedores").then(t=>{this.provider=t.data})},saveSale(){this.loading=!0,this.$axios.post("registrarGasto",this.gasto).then(t=>{this.$emit("gastoCreated",t.data),this.$alert.success("Gasto registrado")}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},proveedorCreateSimple(){this.$q.dialog({title:"Registrar proveedor",message:"Ingrese el nombre del proveedor",prompt:{model:"",type:"text"},cancel:!0,persistent:!0}).onOk(t=>{this.$axios.post("proveedorCreateSimple",{nombre:t}).then(e=>{this.provider.push(e.data),this.gasto.client_id=e.data.id}).catch(e=>{this.$alert.error(e.response.data.message)})})}}},P=n("div",{class:"text-subtitle2 text-bold text-grey"}," Registrar gasto ",-1),L={class:"row"},H={class:"col-12"},W={class:"col-12"},j={class:"col-12"},J={class:"col-12"},K={class:"col-12"};function X(t,e,y,V,a,i){return m(),w(k,{style:{width:"500px","max-width":"80vw"}},{default:s(()=>[o(f,{class:"row items-center q-pb-none"},{default:s(()=>[P,o(E),S(o(d,{icon:"o_highlight_off",flat:"",round:"",dense:""},null,512),[[M]])]),_:1}),o(f,null,{default:s(()=>[o(T,{onSubmit:i.saveSale},{default:s(()=>[n("div",L,[n("div",H,[o(p,{outlined:"",dense:"",modelValue:a.gasto.monto,"onUpdate:modelValue":e[0]||(e[0]=r=>a.gasto.monto=r),label:"Monto *",type:"number",step:"0.1",rules:[r=>!!r||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",W,[o(p,{outlined:"",dense:"",hint:"",modelValue:a.gasto.concepto,"onUpdate:modelValue":e[1]||(e[1]=r=>a.gasto.concepto=r),label:"Descripci\xF3n"},null,8,["modelValue"])]),n("div",j,[o(v,{outlined:"",dense:"",hint:"",modelValue:a.gasto.metodo,"onUpdate:modelValue":e[2]||(e[2]=r=>a.gasto.metodo=r),options:t.$metodos,label:"M\xE9todo de pago"},null,8,["modelValue","options"])]),n("div",J,[o(v,{outlined:"",dense:"",hint:"",modelValue:a.gasto.client_id,"onUpdate:modelValue":e[3]||(e[3]=r=>a.gasto.client_id=r),options:a.provider,label:"Proveedor","emit-value":"","map-options":"","option-value":"id","option-label":"nombre","use-input":""},{after:s(()=>[o(d,{flat:"",dense:"",icon:"add_circle_outline",onClick:i.proveedorCreateSimple,color:"green"},null,8,["onClick"])]),_:1},8,["modelValue","options"])]),n("div",K,[o(d,{type:"submit",label:"Guardar",color:"red-7",class:"full-width","no-caps":"",rounded:"",loading:a.loading},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var Z=x(z,[["render",X]]);const $={name:"IndexPage",components:{DialogGasto:Z,CardComponent:R},data(){return{gastoDialog:!1,fechaInicioSemana:b().startOf("isoWeek").format("YYYY-MM-DD"),fechaFinSemana:b().endOf("isoWeek").format("YYYY-MM-DD"),concepto:"",columns:[{name:"opcion",label:"Opcion",align:"left",field:"opcion"},{name:"concepto",label:"Concepto",align:"left",field:"concepto",sortable:!0},{name:"montoTotal",label:"Monto total",align:"left",field:"montoTotal",sortable:!0},{name:"proveedorcliente",label:"Proveedor / cliente",align:"left",field:"proveedor / cliente",sortable:!0},{name:"fechayhora",label:"Fecha y hora",align:"left",field:"fechayhora",sortable:!0},{name:"egresoingreso",label:"Egreso / ingreso",align:"left",field:"egreso / ingreso",sortable:!0},{name:"user",label:"Usuario",align:"left",field:t=>t.user.name,sortable:!0},{name:"lugar",label:"lugar",align:"left",field:t=>t.user.lugar,sortable:!0}],sales:[],loading:!1,filter:""}},mounted(){this.salesGet()},methods:{saleAnular(t){this.$q.dialog({title:"Anular venta",message:"\xBFEst\xE1 seguro de anular la venta?",persistent:!0,ok:{label:"Si",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(()=>{this.$axios.post("saleAnular",{id:t}).then(e=>{this.salesGet()}).catch(e=>{console.log(e)})})},gastoCreated(t){this.sales.unshift(t),this.gastoDialog=!1},salesGet(){this.loading=!0,this.$axios.get("sales",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto}}).then(t=>{this.sales=t.data,console.log(t.data)}).catch(t=>{console.log(t)}).finally(()=>{this.loading=!1})}},computed:{balance(){return this.sales.reduce((t,e)=>e.estado!=="ANULADO"?e.tipo_venta==="INGRESO"?t+e.total:t-e.total:t,0)},ingreso(){return this.sales.reduce((t,e)=>e.tipo_venta==="INGRESO"&&e.estado!=="ANULADO"?t+e.total:t,0)},gasto(){return this.sales.reduce((t,e)=>e.tipo_venta==="EGRESO"&&e.estado!=="ANULADO"?t+e.total:t,0)}}},ee={class:"row"},oe={class:"col-6 col-md-2 q-pa-xs"},te={class:"col-6 col-md-2 q-pa-xs"},le={class:"col-12 col-md-3 q-pa-xs"},ae={class:"col-12 col-md-5 text-right"},se={class:"col-12 col-md-4 q-pa-xs"},ne={class:"col-12 col-md-4 q-pa-xs"},re={class:"col-12 col-md-4 q-pa-xs"},ie={class:"col-12"},de={key:1},ce={style:{"padding-left":"15px"}},ue={class:"text-grey q-ml-xs",style:{width:"400px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},pe={class:"text-grey"},me={key:0,class:"text-grey"};function ge(t,e,y,V,a,i){const r=_("CardComponent"),C=_("DialogGasto");return m(),h(Q,null,[o(Y,{class:"q-pa-xs bg-grey-3"},{default:s(()=>[n("div",ee,[n("div",oe,[o(p,{modelValue:a.fechaInicioSemana,"onUpdate:modelValue":[e[0]||(e[0]=l=>a.fechaInicioSemana=l),i.salesGet],label:"Fecha inicio",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",te,[o(p,{modelValue:a.fechaFinSemana,"onUpdate:modelValue":[e[1]||(e[1]=l=>a.fechaFinSemana=l),i.salesGet],label:"Fecha fin",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",le,[o(p,{modelValue:a.concepto,"onUpdate:modelValue":[e[2]||(e[2]=l=>a.concepto=l),i.salesGet],label:"Buscar por concepto",dense:"",outlined:"",class:"bg-white",debounce:"300",clearable:"",placeholder:"Buscar por concepto"},{prepend:s(()=>[o(D,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),n("div",ae,[o(d,{label:"Nuevo Venta",color:"green",icon:"add_circle_outline","no-caps":"",rounded:"",to:"/sale"}),o(d,{label:"Nuevo Gasto",color:"red",icon:"add_circle_outline","no-caps":"",rounded:"",onClick:e[3]||(e[3]=l=>a.gastoDialog=!0)})]),n("div",se,[o(r,{monto:i.balance,color:"grey",title:"Balance",icono:"o_trending_up"},null,8,["monto"])]),n("div",ne,[o(r,{monto:i.ingreso,color:"green",title:"Ventas",icono:"o_trending_up"},null,8,["monto"])]),n("div",re,[o(r,{monto:i.gasto,color:"red",title:"Gastos",icono:"o_trending_down"},null,8,["monto"])]),n("div",ie,[o(q,{columns:a.columns,rows:a.sales,dense:"","rows-per-page-options":[0],filter:a.filter,loading:a.loading,"wrap-cells":"","no-data-label":"No hay ventas","no-results-label":"No hay ventas"},{"top-right":s(()=>[o(p,{outlined:"",modelValue:a.filter,"onUpdate:modelValue":e[4]||(e[4]=l=>a.filter=l),debounce:"300",placeholder:"Buscar",dense:""},{append:s(()=>[o(d,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue"])]),body:s(l=>[o(B,{props:l},{default:s(()=>[o(c,{key:"opcion",props:l,"auto-width":""},{default:s(()=>[l.row.estado=="ACTIVO"?(m(),w(A,{key:0},{default:s(()=>[o(d,{dense:"",label:"Anular",color:"red-4",size:"10px","no-caps":"","no-wrap":"",icon:"o_highlight_off",onClick:g=>i.saleAnular(l.row.id)},{default:s(()=>[o(U,null,{default:s(()=>[I("Anular venta")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):(m(),h("div",de,[o(d,{dense:"",label:"Anulado",color:"grey-4",size:"10px","no-caps":"","no-wrap":"",icon:"o_highlight_off"})]))]),_:2},1032,["props"]),o(c,{key:"concepto",props:l,class:""},{default:s(()=>[n("div",null,[o(d,{icon:"o_local_atm",size:"15px",color:`${l.row.tipo_venta=="INGRESO"?"green":"red"}-7`,class:N(`bg-${l.row.tipo_venta=="INGRESO"?"green":"red"}-2`),dense:"",flat:"",style:{padding:"0px",margin:"0px","border-radius":"0px",position:"absolute",top:"5px",left:"0px"}},null,8,["color","class"]),n("div",ce,[n("div",ue,u(l.row.concepto),1)])])]),_:2},1032,["props"]),o(c,{key:"montoTotal",props:l},{default:s(()=>[n("span",pe,u(l.row.total)+" Bs",1)]),_:2},1032,["props"]),o(c,{key:"proveedorcliente",props:l},{default:s(()=>[l.row.client?(m(),h("div",me,u(l.row.client.nombre),1)):O("",!0)]),_:2},1032,["props"]),o(c,{key:"fechayhora",props:l},{default:s(()=>[n("p",null,u(t.$filters.dateDmYHis(l.row.fecha_emision)),1)]),_:2},1032,["props"]),o(c,{key:"egresoingreso",props:l},{default:s(()=>[o(F,{color:`${l.row.tipo_venta=="INGRESO"?"green":"red"}-5`,"text-color":"white",dense:"",flat:"",label:l.row.tipo_venta},null,8,["color","label"])]),_:2},1032,["props"]),o(c,{key:"user",props:l},{default:s(()=>{var g;return[n("p",null,u((g=l.row.user)==null?void 0:g.name),1)]}),_:2},1032,["props"]),o(c,{key:"lugar",props:l},{default:s(()=>[n("p",null,u(l.row.lugar),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["columns","rows","filter","loading"])])])]),_:1}),o(G,{modelValue:a.gastoDialog,"onUpdate:modelValue":e[5]||(e[5]=l=>a.gastoDialog=l),position:"right",maximized:""},{default:s(()=>[o(C,{onGastoCreated:i.gastoCreated},null,8,["onGastoCreated"])]),_:1},8,["modelValue"])],64)}var Ge=x($,[["render",ge]]);export{Ge as default};
