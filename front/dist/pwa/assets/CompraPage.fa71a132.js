import{_ as A,C as y,D as p,E as w,F as i,H as s,G as l,K as _,ao as h,b6 as U,an as m,Q as u,b0 as P,aq as v,I as r,J as f,ap as b,z as k,b8 as q,b7 as D,as as E,ar as Q}from"./index.649a13f7.js";import{Q as g,c as O}from"./QMarkupTable.19b718c5.js";import{Q as R,a as V}from"./QTable.1f9a5e19.js";import{I as T,Q as N}from"./Imprimir.ff392614.js";import{C as F,Q as G,a as z}from"./CalculatePage.0669bf1f.js";import{a as C,Q as L}from"./QItem.35c932ed.js";import{Q as M}from"./QTooltip.7b6d7cdf.js";import{Q as H}from"./QList.e6bcfb82.js";import{Q as J}from"./QSpace.45414151.js";import{Q as K}from"./QForm.5bb268c4.js";import{Q as j}from"./QPage.82ead2e2.js";import{C as I}from"./ClosePopup.34d1900a.js";import{P as W}from"./ProductsComponents.599f6b4b.js";import"./format.d97dd654.js";import"./moment.40bc58bf.js";import"./QScrollObserver.9fc4f00c.js";import"./TouchPan.37027830.js";import"./Alert.5cdbff0b.js";import"./QImg.01ab78c0.js";const X={name:"ProductosPage",components:{CalculatePage:F,ProductsComponents:W},data(){return{descuento:"",vista:"tabla",calculateDialog:!1,metodoPago:"EFECTIVO",precio:"PRECIO 1",almacenSelected:"Todo",search:"",categories:[{id:"",name:"Selecciona una categor\xEDa"}],loading:!1,categoriSelected:"",ordenes:["Selecciona un orden","Alfab\xE9tico","Producto m\xE1s vendido","Producto menos vendido","Ultimas unidades disponibles"],ordenSelected:"Selecciona un orden",medidas:[],products:[],productsAll:[],saleDialog:!1,client:{nit:"",nombre:""},efectivo:"",proveedores:[],proveedoresAll:[],proveedor_id:"",observacion:""}},mounted(){this.proveedoresGet(),this.categoriesGet(),this.productsGet(),this.medidasGet()},methods:{fnFilter(e,o){if(e==="")o(()=>{this.proveedores=this.proveedoresAll});else{const n=e.toLowerCase();o(()=>{this.proveedores=this.proveedoresAll.filter(x=>x.nombre.toLowerCase().indexOf(n)>-1)})}},proveedoresGet(){this.$axios.get("proveedores").then(e=>{this.proveedores=this.proveedores.concat(e.data),this.proveedoresAll=e.data})},numero2digitosRedondeado(e){return(Math.round(e*100)/100).toFixed(2)},saleInsert(){if(this.$store.productosBuys.length===0){this.$q.notify({color:"red",position:"top",message:"No hay productos en la canasta",icon:"report_problem"});return}if(this.proveedor_id===""){this.$q.notify({color:"red",position:"top",message:"Seleccione un proveedor",icon:"report_problem"});return}this.loading=!0,this.$axios.post("buys",{proveedor_id:this.proveedor_id,observacion:this.observacion,productos:this.$store.productosBuys,descuento:this.descuento}).then(e=>{this.$q.notify({color:"green",position:"top",message:"Compra realizada",icon:"cloud_done"}),this.saleDialog=!1,this.$store.productosBuys=[],this.productsGet(),T.notaCompra(e.data)}).finally(()=>{this.loading=!1})},precioVenta(e){e.precioVenta===""&&(e.precioVenta=1)},cambioNumero(e,o){console.log(e)},removeCantidad(e,o){e.cantidad++,e.cantidadPedida--,e.cantidadVenta>1?e.cantidadVenta=parseInt(e.cantidadVenta)-1:e.cantidadVenta===1&&this.$store.productosBuys.splice(o,1)},addCantidad(e,o){e.cantidad--,e.cantidadPedida++,e.cantidadVenta=parseInt(e.cantidadVenta)+1},deleteProductosVenta(e,o){this.$store.productosBuys.splice(o,1)},redondeo(e){return Math.round(e*100)/100},clickDetalleProducto(e){const o=this.$store.productosBuys.find(n=>n.id===e.id);o?o.cantidadVenta+=1:(this.precio==="PRECIO 1"&&(e.precioVenta=e.precio1),this.precio==="PRECIO 2"&&(e.precioVenta=e.precio2),this.precio==="PRECIO 3"&&(e.precioVenta=e.precio3),this.precio==="PRECIO 4"&&(e.precioVenta=e.precio4),this.precio==="PRECIO 5"&&(e.precioVenta=e.precio5),this.precio==="PRECIO 6"&&(e.precioVenta=e.precio6),this.$store.productosBuys.push({id:e.id,nombre:e.nombre,cantidadVenta:1,precioVenta:e.precioVenta,costoUnitario:e.costoUnitario,stock:e.stock,image:e.image}))},clickSale(){this.saleDialog=!0,this.efectivo="",this.client={nit:"0",nombre:"SN"}},vaciarCanasta(){this.$store.productosBuys=[]},searchProductsOrder(e){e===""&&(this.products=this.productsAll),e==="Alfab\xE9tico"&&(this.products=this.productsAll.sort((o,n)=>o.nombre.localeCompare(n.nombre))),e==="Producto m\xE1s vendido"&&(this.products=this.productsAll.sort((o,n)=>n.cantidadVentas-o.cantidadVentas)),e==="Producto menos vendido"&&(this.products=this.productsAll.sort((o,n)=>o.cantidadVentas+n.cantidadVentas)),e==="Ultimas unidades disponibles"&&(this.products=this.productsAll.sort((o,n)=>o.stock-n.stock))},searchProductsCategory(e){e===""?this.products=this.productsAll:this.products=this.productsAll.filter(o=>o.category_id===e)},medidasGet(){this.$axios.get("medidas").then(e=>{this.medidas=this.medidas.concat(e.data)})},searchProducts(){this.search===""?this.products=this.productsAll:this.products=this.productsAll.filter(e=>e.nombre.toLowerCase().includes(this.search.toLowerCase()))},categoriesGet(){this.$axios.get("categories").then(e=>{this.categories=this.categories.concat(e.data)})},productsGet(){this.loading=!0,this.$axios.get("products").then(e=>{this.loading=!1,this.products=e.data,this.productsAll=e.data})},searchClient(e){this.loading=!0,this.$axios.post("searchClient",{nit:e}).then(o=>{o.data.nombre!==void 0&&(this.client.nombre=o.data.nombre)}).finally(()=>{this.loading=!1})}},computed:{cambio(){const e=parseFloat(this.efectivo===""?0:this.efectivo),o=parseFloat(this.total===""?0:this.total);return Math.round((e-o)*100)/100},total(){const e=this.$store.productosBuys.reduce((o,n)=>o+n.cantidadVenta*n.precioVenta,0);return Math.round(e*100)/100},totalganancia(){return this.$store.productosBuys.reduce((e,o)=>e+(o.cantidadVenta*o.precioVenta-o.costoUnitario)*o.cantidadVenta,0)},columnsProductosVenta(){return[{name:"borrar",align:"center",label:"Borrar",field:"borrar"},{name:"nombre",align:"center",label:"Nombre",field:"nombre"},{name:"cantidadVenta",align:"center",label:"Cantidad",field:"cantidadVenta"}]},ruleNumber(){return[e=>!!e||"Campo requerido",e=>e&&e>0||"Debe ser mayor a 0"]}}},Y={class:"row"},Z={class:"col-12 col-md-8"},$={class:"row"},ee={class:"col-12 col-md-3"},oe={class:"col-6 col-md-2 text-right"},te=s("div",{class:"col-6 col-md-7 text-right"},null,-1),se={class:"col-4 col-md-3"},le={class:"col-8 col-md-3"},ae={class:"col-4 col-md-2"},ie={class:"col-12 col-md-2 text-right"},de=s("div",{class:"col-12 col-md-2 text-right"},null,-1),ne={class:"col-12"},re={class:"col-12 col-md-4"},ce={class:"row"},ue=s("div",{class:"col-6 text-h6 q-pt-xs q-pl-lg text-red"},"Compra",-1),me={class:"col-6 text-right"},pe={key:0,class:"flex flex-center q-pa-lg"},he=s("div",{class:"q-pa-lg text-grey text-center noSelect"}," A\xFAn no tienes productos en tu canasta. Haz clic sobre un producto para agregarlo. ",-1),ge={class:"text-caption",style:{"max-width":"170px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},fe={class:"text-grey"},_e=s("div",{style:{"font-size":"10px"}},"Bs.",-1),ve={class:"text-grey"},be={class:"text-right text-grey-8 text-bold"},Ve={class:"row"},Ce=s("div",{class:"col-7 text-grey"},"Cantidades de referencia",-1),xe={class:"col-5 text-right"},ye={class:"col-7 text-grey"},we={class:"col-5 text-right text-green"},Pe=s("div",{class:"text-h6"},"Realizar Compra",-1),ke=s("thead",null,[s("tr",null,[s("th",null,"#"),s("th",null,"Nombre"),s("th",null,"Cantidad"),s("th",null,"Precio"),s("th",null,"Subtotal")])],-1),Qe={class:"text-right"},Ie={class:"text-right text-bold"},Se={colspan:"2",class:"text-right text-bold"},Be=s("td",{colspan:"2",class:"text-right text-bold"},"Total",-1),Ae={class:"text-right text-bold"},Ue={class:"row q-pa-xs"},qe={class:"col-4"},De={class:"col-8"},Ee={class:"row"},Oe={class:"col-6"},Re={class:"col-6"},Te=s("div",{id:"myElement",class:"hidden"},null,-1);function Ne(e,o,n,x,a,d){const S=y("ProductsComponents"),B=y("CalculatePage");return p(),w(j,{class:"bg-grey-3 q-pa-xs"},{default:i(()=>[s("div",Y,[s("div",Z,[s("div",$,[s("div",ee,[l(h,{modelValue:a.search,"onUpdate:modelValue":[o[0]||(o[0]=t=>a.search=t),d.searchProducts],label:"Buscar",outlined:"",dense:"",class:"bg-white",loading:a.loading},{prepend:i(()=>[l(_,{name:"o_search"})]),_:1},8,["modelValue","onUpdate:modelValue","loading"])]),s("div",oe,[l(U,{"model-value":"vista",label:a.vista,color:"primary",dense:"",modelValue:a.vista,"onUpdate:modelValue":o[1]||(o[1]=t=>a.vista=t),"false-value":"lista","true-value":"tabla"},null,8,["label","modelValue"])]),te,s("div",se,[l(g,{modelValue:a.categoriSelected,"onUpdate:modelValue":[o[2]||(o[2]=t=>a.categoriSelected=t),d.searchProductsCategory],options:a.categories,label:"Categor\xEDa",outlined:"",dense:"",class:"bg-white","emit-value":"","map-options":"","option-label":t=>t.name,"option-value":t=>t.id},null,8,["modelValue","options","option-label","option-value","onUpdate:modelValue"])]),s("div",le,[l(g,{modelValue:a.ordenSelected,"onUpdate:modelValue":[o[3]||(o[3]=t=>a.ordenSelected=t),d.searchProductsOrder],options:a.ordenes,label:"Ordenar por",outlined:"",dense:"",class:"bg-white","emit-value":""},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",ae,[l(g,{modelValue:a.almacenSelected,"onUpdate:modelValue":o[4]||(o[4]=t=>a.almacenSelected=t),options:["Todo","Almacen 1","Almacen 2"],label:"Almacen",outlined:"",dense:"",class:"bg-white","emit-value":""},null,8,["modelValue"])]),s("div",ie,[l(g,{modelValue:a.precio,"onUpdate:modelValue":o[5]||(o[5]=t=>a.precio=t),options:["PRECIO 1","PRECIO 2","PRECIO 3","PRECIO 4","PRECIO 5","PRECIO 6"],label:"Precio",outlined:"",dense:"",class:"bg-white","emit-value":""},null,8,["modelValue"])]),de,s("div",ne,[l(S,{products:a.products,onClickDetalleProducto:d.clickDetalleProducto,precio:a.precio,almacenSelected:a.almacenSelected,vista:a.vista},null,8,["products","onClickDetalleProducto","precio","almacenSelected","vista"])])])]),s("div",re,[l(b,null,{default:i(()=>[l(m,{class:"q-pa-none q-ma-none"},{default:i(()=>[s("div",ce,[ue,s("div",me,[l(u,{class:"text-subtitle1 text-blue-10 text-bold",style:{"text-decoration":"underline"},label:"Vaciar ",onClick:d.vaciarCanasta,"no-caps":"",flat:"",outline:""},null,8,["onClick"])])])]),_:1}),l(P),l(m,{class:"q-pa-none q-ma-none"},{default:i(()=>[e.$store.productosBuys.length==0?(p(),v("div",pe,[l(_,{name:"o_shopping_basket",color:"grey",size:"100px"}),he])):(p(),w(G,{key:1,style:{height:"400px"}},{default:i(()=>[l(R,{dense:"",flat:"",bordered:"","hide-bottom":"","hide-header":"",rows:e.$store.productosBuys,columns:d.columnsProductosVenta,"rows-per-page-options":[0]},{body:i(t=>[l(N,{props:t},{default:i(()=>[l(V,{key:"borrar",props:t,style:{padding:"0px",margin:"0px"},"auto-width":""},{default:i(()=>[l(u,{flat:"",dense:"",onClick:c=>d.deleteProductosVenta(t.row,t.pageIndex),icon:"delete",color:"red",size:"10px",class:"q-pa-none q-ma-none"},null,8,["onClick"])]),_:2},1032,["props"]),l(V,{key:"nombre",props:t,"auto-width":""},{default:i(()=>[s("div",null,[s("div",null,[s("div",ge,r(t.row.nombre),1),s("div",fe,"Disponible: "+r(t.row.stock),1),l(h,{modelValue:t.row.precioVenta,"onUpdate:modelValue":[c=>t.row.precioVenta=c,c=>d.precioVenta(t.row)],style:{width:"170px"},class:"super-small",step:"0.01",type:"number",dense:"",outlined:""},{prepend:i(()=>[_e]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["props"]),l(V,{key:"cantidadVenta",props:t},{default:i(()=>[l(h,{dense:"",outlined:"","bottom-slots":"",min:"1",class:"super-small",modelValue:t.row.cantidadVenta,"onUpdate:modelValue":[c=>t.row.cantidadVenta=c,c=>d.cambioNumero(t.row,t.pageIndex)],rules:d.ruleNumber,type:"number","input-class":"text-center",required:""},{prepend:i(()=>[l(u,{style:{cursor:"pointer"},dense:"",flat:"",icon:"remove_circle_outline",onClick:c=>d.removeCantidad(t.row,t.pageIndex)},null,8,["onClick"])]),append:i(()=>[l(u,{style:{cursor:"pointer"},dense:"",flat:"",icon:"add_circle_outline",onClick:c=>d.addCantidad(t.row,t.pageIndex)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","rules"]),s("div",ve,"= Bs "+r(d.redondeo(t.row.cantidadVenta*t.row.precioVenta)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1}))]),_:1}),l(m,null,{default:i(()=>[l(H,{padding:"",bordered:"",dense:"",class:"rounded-borders full-width q-pa-none q-ma-none"},{default:i(()=>[l(z,{dense:"","dense-toggle":"","expand-separator":"",label:"Total"},{header:i(()=>[l(C,null,{default:i(()=>[f(" Total ")]),_:1}),l(C,{side:""},{default:i(()=>[s("div",be,[s("u",null," Bs "+r(d.total),1)])]),_:1})]),default:i(()=>[l(b,null,{default:i(()=>[l(m,null,{default:i(()=>[s("div",Ve,[Ce,s("div",xe,r(e.$store.productosBuys.length),1),s("div",ye,[f(" Ganancia "),l(_,{name:"o_info"},{default:i(()=>[l(M,{anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:i(()=>[f(" Para calcular la ganancia correctamente, deber\xE1s cargar el costo unitario de todos los productos desde tu Inventario. ")]),_:1})]),_:1})]),s("div",we,r(d.totalganancia)+" Bs",1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(u,{onClick:d.clickSale,class:"full-width","no-caps":"",label:"Confirmar compra",color:e.$store.productosBuys.length==0?"grey":"deep-orange",disable:e.$store.productosBuys.length==0},null,8,["onClick","color","disable"])]),_:1})]),_:1})])]),l(Q,{modelValue:a.saleDialog,"onUpdate:modelValue":o[9]||(o[9]=t=>a.saleDialog=t),persistent:""},{default:i(()=>[l(b,{style:{width:"750px","max-width":"90vw"}},{default:i(()=>[l(m,{class:"row items-center q-pb-none"},{default:i(()=>[Pe,l(J),k(l(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[I]])]),_:1}),l(K,{onSubmit:q(d.saleInsert,["prevent"])},{default:i(()=>[l(O,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:i(()=>[ke,s("tbody",null,[(p(!0),v(E,null,D(e.$store.productosBuys,(t,c)=>(p(),v("tr",{key:t.id},[s("td",null,r(c+1),1),s("td",null,r(t.nombre),1),s("td",null,r(t.cantidadVenta),1),s("td",Qe,r(d.numero2digitosRedondeado(t.precioVenta)),1),s("td",Ie,r(d.numero2digitosRedondeado(t.cantidadVenta*t.precioVenta))+" Bs.",1)]))),128)),s("tr",null,[s("td",Se,[l(h,{label:"Descuento",modelValue:a.descuento,"onUpdate:modelValue":o[6]||(o[6]=t=>a.descuento=t),dense:"",outlined:""},null,8,["modelValue"])]),Be,s("td",Ae,r(d.numero2digitosRedondeado(d.total-a.descuento))+" Bs.",1)])])]),_:1}),s("div",Ue,[s("div",qe,[l(g,{modelValue:a.proveedor_id,"onUpdate:modelValue":o[7]||(o[7]=t=>a.proveedor_id=t),options:a.proveedores,label:"Proveedor",outlined:"",dense:"",class:"bg-white","emit-value":"","map-options":"","option-value":"id","option-label":"nombre",onFilter:d.fnFilter,"use-input":"","input-debounce":"0","hide-selected":"","fill-input":""},{"no-option":i(()=>[l(L,null,{default:i(()=>[l(C,{class:"text-grey"},{default:i(()=>[f(" No hay resultados ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter"])]),s("div",De,[l(h,{outlined:"",dense:"",label:"Observaciones",modelValue:a.observacion,"onUpdate:modelValue":o[8]||(o[8]=t=>a.observacion=t)},null,8,["modelValue"])])]),l(P),l(m,null,{default:i(()=>[s("div",Ee,[s("div",Oe,[l(u,{type:"submit",class:"full-width",icon:"o_add_circle",label:"Realizar Compra",loading:a.loading,"no-caps":"",color:"positive"},null,8,["loading"])]),s("div",Re,[k(l(u,{class:"full-width",icon:"undo",label:"Atras","no-caps":"",color:"red",loading:a.loading},null,8,["loading"]),[[I]])])])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),l(Q,{modelValue:a.calculateDialog,"onUpdate:modelValue":o[11]||(o[11]=t=>a.calculateDialog=t),position:"left","full-height":""},{default:i(()=>[l(B,{onClose:o[10]||(o[10]=t=>a.calculateDialog=!1),products:a.products},null,8,["products"])]),_:1},8,["modelValue"]),Te]),_:1})}var ao=A(X,[["render",Ne]]);export{ao as default};
