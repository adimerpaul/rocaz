import{_ as D,C as x,D as h,E as C,F as i,H as a,G as l,K as p,ak as g,b5 as U,Q as u,aj as m,aH as w,am as V,I as r,J as _,al as b,z as P,b7 as A,b6 as E,ao as R,an as y}from"./index.f2c7814e.js";import{Q as f,d as O}from"./QSelect.0bdb6846.js";import{Q as q,a as v}from"./QTable.864aebbb.js";import{Q as B}from"./QImg.fae8c61b.js";import{I as T,Q as N}from"./Imprimir.43f60163.js";import{C as z,Q as G,a as F}from"./CalculatePage.01e753fa.js";import{a as k}from"./format.272cd4b9.js";import{Q as M}from"./QTooltip.dae06d3d.js";import{Q as L}from"./QList.7e5cbe03.js";import{Q as H}from"./QSpace.fc9ea4c7.js";import{Q as j}from"./QForm.785af612.js";import{Q as J}from"./QPage.8348411c.js";import{C as Q}from"./ClosePopup.c817209b.js";import{P as K}from"./ProductsComponents.a001f5af.js";import"./QScrollObserver.03857de7.js";import"./TouchPan.28e79d8d.js";const W={name:"ProductosPage",components:{CalculatePage:z,ProductsComponents:K},data(){return{descuento:"",vista:"tabla",calculateDialog:!1,metodoPago:"EFECTIVO",precio:"PRECIO 1",almacenSelected:"Todo",search:"",categories:[{id:"",name:"Selecciona una categor\xEDa"}],loading:!1,categoriSelected:"",ordenes:["Selecciona un orden","Alfab\xE9tico","Producto m\xE1s vendido","Producto menos vendido","Ultimas unidades disponibles"],ordenSelected:"Selecciona un orden",medidas:[],products:[],productsAll:[],saleDialog:!1,client:{nit:"",nombre:""},efectivo:""}},mounted(){this.categoriesGet(),this.productsGet(),this.medidasGet()},methods:{numero2digitosRedondeado(e){return(Math.round(e*100)/100).toFixed(2)},saleInsert(){this.loading=!0,this.$axios.post("sales",{nit:this.client.nit,nombre:this.client.nombre,total:this.total,metodo:this.metodoPago,almacen:this.almacenSelected,productos:this.$store.productosVenta,descuento:this.descuento}).then(e=>{T.nota(e.data),this.productsGet(),this.$alert.success("Venta realizada")}).finally(()=>{this.loading=!1,this.saleDialog=!1,this.$store.productosVenta=[]})},precioVenta(e){e.precioVenta===""&&(e.precioVenta=1)},cambioNumero(e,o){console.log(e)},removeCantidad(e,o){e.cantidad++,e.cantidadPedida--,e.cantidadVenta>1?e.cantidadVenta=parseInt(e.cantidadVenta)-1:e.cantidadVenta===1&&this.$store.productosVenta.splice(o,1)},addCantidad(e,o){e.cantidad--,e.cantidadPedida++,e.cantidadVenta=parseInt(e.cantidadVenta)+1},deleteProductosVenta(e,o){this.$store.productosVenta.splice(o,1)},redondeo(e){return Math.round(e*100)/100},clickDetalleProducto(e){const o=this.$store.productosVenta.find(d=>d.id===e.id);o?o.cantidadVenta+=1:(this.precio==="PRECIO 1"&&(e.precioVenta=e.precio1),this.precio==="PRECIO 2"&&(e.precioVenta=e.precio2),this.precio==="PRECIO 3"&&(e.precioVenta=e.precio3),this.precio==="PRECIO 4"&&(e.precioVenta=e.precio4),this.precio==="PRECIO 5"&&(e.precioVenta=e.precio5),this.precio==="PRECIO 6"&&(e.precioVenta=e.precio6),this.$store.productosVenta.push({id:e.id,nombre:e.nombre,cantidadVenta:1,precioVenta:e.precioVenta,costoUnitario:e.costoUnitario,stock:e.stock,image:e.image}))},clickSale(){this.saleDialog=!0,this.efectivo="",this.client={nit:"0",nombre:"SN"}},vaciarCanasta(){this.$store.productosVenta=[]},searchProductsOrder(e){e===""&&(this.products=this.productsAll),e==="Alfab\xE9tico"&&(this.products=this.productsAll.sort((o,d)=>o.nombre.localeCompare(d.nombre))),e==="Producto m\xE1s vendido"&&(this.products=this.productsAll.sort((o,d)=>d.cantidadVentas-o.cantidadVentas)),e==="Producto menos vendido"&&(this.products=this.productsAll.sort((o,d)=>o.cantidadVentas+d.cantidadVentas)),e==="Ultimas unidades disponibles"&&(this.products=this.productsAll.sort((o,d)=>o.stock-d.stock))},searchProductsCategory(e){e===""?this.products=this.productsAll:this.products=this.productsAll.filter(o=>o.category_id===e)},medidasGet(){this.$axios.get("medidas").then(e=>{this.medidas=this.medidas.concat(e.data)})},searchProducts(){this.search===""?this.products=this.productsAll:this.products=this.productsAll.filter(e=>e.nombre.toLowerCase().includes(this.search.toLowerCase()))},categoriesGet(){this.$axios.get("categories").then(e=>{this.categories=this.categories.concat(e.data)})},productsGet(){this.loading=!0,this.$axios.get("products").then(e=>{this.loading=!1,this.products=e.data,this.productsAll=e.data})},searchClient(e){this.loading=!0,this.$axios.post("searchClient",{nit:e}).then(o=>{o.data.nombre!==void 0&&(this.client.nombre=o.data.nombre)}).finally(()=>{this.loading=!1})}},computed:{cambio(){const e=parseFloat(this.efectivo===""?0:this.efectivo),o=parseFloat(this.total===""?0:this.total);return Math.round((e-o)*100)/100},total(){const e=this.$store.productosVenta.reduce((o,d)=>o+d.cantidadVenta*d.precioVenta,0);return Math.round(e*100)/100},totalganancia(){return this.$store.productosVenta.reduce((e,o)=>e+(o.cantidadVenta*o.precioVenta-o.costoUnitario)*o.cantidadVenta,0)},columnsProductosVenta(){return[{name:"borrar",align:"center",label:"Borrar",field:"borrar"},{name:"nombre",align:"center",label:"Nombre",field:"nombre"},{name:"cantidadVenta",align:"center",label:"Cantidad",field:"cantidadVenta"}]},ruleNumber(){return[e=>!!e||"Campo requerido",e=>e&&e>0||"Debe ser mayor a 0"]}}},X={class:"row"},Y={class:"col-12 col-md-8"},Z={class:"row"},$={class:"col-12 col-md-3"},ee={class:"col-6 col-md-2 text-right"},te=a("div",{class:"col-6 col-md-7 text-right"},null,-1),oe={class:"col-4 col-md-3"},ae={class:"col-8 col-md-3"},le={class:"col-4 col-md-2"},se={class:"col-12 col-md-2 text-right"},ie={class:"col-12 col-md-2 text-right"},ne={class:"col-12"},de={class:"col-12 col-md-4"},re={class:"row"},ce=a("div",{class:"col-6 text-h6 q-pt-xs q-pl-lg"},"Canasta",-1),ue={class:"col-6 text-right"},me={key:0,class:"flex flex-center q-pa-lg"},he=a("div",{class:"q-pa-lg text-grey text-center noSelect"}," A\xFAn no tienes productos en tu canasta. Haz clic sobre un producto para agregarlo. ",-1),pe={style:{"padding-left":"42px"}},ge={class:"text-caption",style:{"max-width":"170px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},fe={class:"text-grey"},Ve=a("div",{style:{"font-size":"10px"}},"Bs.",-1),_e={class:"text-grey"},be={class:"text-right text-grey-8 text-bold"},ve={class:"row"},xe=a("div",{class:"col-7 text-grey"},"Cantidades de referencia",-1),Ce={class:"col-5 text-right"},we={class:"col-7 text-grey"},Pe={class:"col-5 text-right text-green"},ye=a("div",{class:"text-h6"},"Realizar venta",-1),ke=a("thead",null,[a("tr",null,[a("th",null,"#"),a("th",null,"Nombre"),a("th",null,"Cantidad"),a("th",null,"Precio"),a("th",null,"Subtotal")])],-1),Qe={class:"text-right"},Se={class:"text-right text-bold"},Ie={colspan:"2",class:"text-right text-bold"},De=a("td",{colspan:"2",class:"text-right text-bold"},"Total",-1),Ue={class:"text-right text-bold"},Ae={class:"row"},Ee={class:"col-6"},Re={class:"col-6"},Oe=a("div",{id:"myElement",class:"hidden"},null,-1);function qe(e,o,d,Be,s,n){const S=x("ProductsComponents"),I=x("CalculatePage");return h(),C(J,{class:"bg-grey-3 q-pa-xs"},{default:i(()=>[a("div",X,[a("div",Y,[a("div",Z,[a("div",$,[l(g,{modelValue:s.search,"onUpdate:modelValue":[o[0]||(o[0]=t=>s.search=t),n.searchProducts],label:"Buscar",outlined:"",dense:"",class:"bg-white",loading:s.loading},{prepend:i(()=>[l(p,{name:"o_search"})]),_:1},8,["modelValue","onUpdate:modelValue","loading"])]),a("div",ee,[l(U,{"model-value":"vista",label:s.vista,color:"primary",dense:"",modelValue:s.vista,"onUpdate:modelValue":o[1]||(o[1]=t=>s.vista=t),"false-value":"lista","true-value":"tabla"},null,8,["label","modelValue"])]),te,a("div",oe,[l(f,{modelValue:s.categoriSelected,"onUpdate:modelValue":[o[2]||(o[2]=t=>s.categoriSelected=t),n.searchProductsCategory],options:s.categories,label:"Categor\xEDa",outlined:"",dense:"",class:"bg-white","emit-value":"","map-options":"","option-label":t=>t.name,"option-value":t=>t.id},null,8,["modelValue","options","option-label","option-value","onUpdate:modelValue"])]),a("div",ae,[l(f,{modelValue:s.ordenSelected,"onUpdate:modelValue":[o[3]||(o[3]=t=>s.ordenSelected=t),n.searchProductsOrder],options:s.ordenes,label:"Ordenar por",outlined:"",dense:"",class:"bg-white","emit-value":""},null,8,["modelValue","options","onUpdate:modelValue"])]),a("div",le,[l(f,{modelValue:s.almacenSelected,"onUpdate:modelValue":o[4]||(o[4]=t=>s.almacenSelected=t),options:["Todo","Almacen 1","Almacen 2"],label:"Almacen",outlined:"",dense:"",class:"bg-white","emit-value":""},null,8,["modelValue"])]),a("div",se,[l(f,{modelValue:s.precio,"onUpdate:modelValue":o[5]||(o[5]=t=>s.precio=t),options:["PRECIO 1","PRECIO 2","PRECIO 3","PRECIO 4","PRECIO 5","PRECIO 6"],label:"Precio",outlined:"",dense:"",class:"bg-white","emit-value":""},null,8,["modelValue"])]),a("div",ie,[l(u,{label:"Calculos",color:"green",icon:"o_calculate","no-caps":"",rounded:"",class:"bg-white",onClick:o[6]||(o[6]=t=>s.calculateDialog=!0)})]),a("div",ne,[l(S,{products:s.products,onClickDetalleProducto:n.clickDetalleProducto,precio:s.precio,almacenSelected:s.almacenSelected,vista:s.vista},null,8,["products","onClickDetalleProducto","precio","almacenSelected","vista"])])])]),a("div",de,[l(b,null,{default:i(()=>[l(m,{class:"q-pa-none q-ma-none"},{default:i(()=>[a("div",re,[ce,a("div",ue,[l(u,{class:"text-subtitle1 text-blue-10 text-bold",style:{"text-decoration":"underline"},label:"Vaciar canasta",onClick:n.vaciarCanasta,"no-caps":"",flat:"",outline:""},null,8,["onClick"])])])]),_:1}),l(w),l(m,{class:"q-pa-none q-ma-none"},{default:i(()=>[e.$store.productosVenta.length==0?(h(),V("div",me,[l(p,{name:"o_shopping_basket",color:"grey",size:"100px"}),he])):(h(),C(G,{key:1,style:{height:"400px"}},{default:i(()=>[l(q,{dense:"",flat:"",bordered:"","hide-bottom":"","hide-header":"",rows:e.$store.productosVenta,columns:n.columnsProductosVenta,"rows-per-page-options":[0]},{body:i(t=>[l(N,{props:t},{default:i(()=>[l(v,{key:"borrar",props:t,style:{padding:"0px",margin:"0px"},"auto-width":""},{default:i(()=>[l(u,{flat:"",dense:"",onClick:c=>n.deleteProductosVenta(t.row,t.pageIndex),icon:"delete",color:"red",size:"10px",class:"q-pa-none q-ma-none"},null,8,["onClick"])]),_:2},1032,["props"]),l(v,{key:"nombre",props:t,"auto-width":""},{default:i(()=>[a("div",null,[l(B,{src:t.row.image.includes("http")?t.row.image:`${e.$url}../images/${t.row.image}`,width:"40px",height:"40px",style:{padding:"0px",margin:"0px","border-radius":"0px",position:"absolute",top:"20px",left:"8px"}},null,8,["src"]),a("div",pe,[a("div",ge,r(t.row.nombre),1),a("div",fe,"Disponible: "+r(t.row.stock),1),l(g,{modelValue:t.row.precioVenta,"onUpdate:modelValue":[c=>t.row.precioVenta=c,c=>n.precioVenta(t.row)],style:{width:"170px"},class:"super-small",step:"0.01",type:"number",dense:"",outlined:""},{prepend:i(()=>[l(p,{name:"edit",size:"xs"}),Ve]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["props"]),l(v,{key:"cantidadVenta",props:t},{default:i(()=>[l(g,{dense:"",outlined:"","bottom-slots":"",min:"1",class:"super-small",modelValue:t.row.cantidadVenta,"onUpdate:modelValue":[c=>t.row.cantidadVenta=c,c=>n.cambioNumero(t.row,t.pageIndex)],rules:n.ruleNumber,type:"number","input-class":"text-center",required:""},{prepend:i(()=>[l(u,{style:{cursor:"pointer"},dense:"",flat:"",icon:"remove_circle_outline",onClick:c=>n.removeCantidad(t.row,t.pageIndex)},null,8,["onClick"])]),append:i(()=>[l(u,{style:{cursor:"pointer"},dense:"",flat:"",icon:"add_circle_outline",onClick:c=>n.addCantidad(t.row,t.pageIndex)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","rules"]),a("div",_e,"= Bs "+r(n.redondeo(t.row.cantidadVenta*t.row.precioVenta)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1}))]),_:1}),l(m,null,{default:i(()=>[l(L,{padding:"",bordered:"",dense:"",class:"rounded-borders full-width q-pa-none q-ma-none"},{default:i(()=>[l(F,{dense:"","dense-toggle":"","expand-separator":"",label:"Total"},{header:i(()=>[l(k,null,{default:i(()=>[_(" Total ")]),_:1}),l(k,{side:""},{default:i(()=>[a("div",be,[a("u",null," Bs "+r(n.total),1)])]),_:1})]),default:i(()=>[l(b,null,{default:i(()=>[l(m,null,{default:i(()=>[a("div",ve,[xe,a("div",Ce,r(e.$store.productosVenta.length),1),a("div",we,[_(" Ganancia "),l(p,{name:"o_info"},{default:i(()=>[l(M,{anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:i(()=>[_(" Para calcular la ganancia correctamente, deber\xE1s cargar el costo unitario de todos los productos desde tu Inventario. ")]),_:1})]),_:1})]),a("div",Pe,r(n.totalganancia)+" Bs",1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(u,{onClick:n.clickSale,class:"full-width","no-caps":"",label:"Confirmar venta",color:e.$store.productosVenta.length==0?"grey":"warning",disable:e.$store.productosVenta.length==0},null,8,["onClick","color","disable"])]),_:1})]),_:1})])]),l(y,{modelValue:s.saleDialog,"onUpdate:modelValue":o[8]||(o[8]=t=>s.saleDialog=t),persistent:""},{default:i(()=>[l(b,{style:{width:"750px","max-width":"90vw"}},{default:i(()=>[l(m,{class:"row items-center q-pb-none"},{default:i(()=>[ye,l(H),P(l(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Q]])]),_:1}),l(j,{onSubmit:A(n.saleInsert,["prevent"])},{default:i(()=>[l(O,{dense:"","wrap-cells":""},{default:i(()=>[ke,a("tbody",null,[(h(!0),V(R,null,E(e.$store.productosVenta,(t,c)=>(h(),V("tr",{key:t.id},[a("td",null,r(c+1),1),a("td",null,r(t.nombre),1),a("td",null,r(t.cantidadVenta),1),a("td",Qe,r(n.numero2digitosRedondeado(t.precioVenta)),1),a("td",Se,r(n.numero2digitosRedondeado(t.cantidadVenta*t.precioVenta))+" Bs.",1)]))),128)),a("tr",null,[a("td",Ie,[l(g,{label:"Descuento",modelValue:s.descuento,"onUpdate:modelValue":o[7]||(o[7]=t=>s.descuento=t),dense:"",outlined:""},null,8,["modelValue"])]),De,a("td",Ue,r(n.numero2digitosRedondeado(n.total-s.descuento))+" Bs.",1)])])]),_:1}),l(w),l(m,null,{default:i(()=>[a("div",Ae,[a("div",Ee,[l(u,{type:"submit",class:"full-width",icon:"o_add_circle",label:"Realizar venta",loading:s.loading,"no-caps":"",color:"green"},null,8,["loading"])]),a("div",Re,[P(l(u,{class:"full-width",icon:"undo",label:"Atras","no-caps":"",color:"red",loading:s.loading},null,8,["loading"]),[[Q]])])])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),l(y,{modelValue:s.calculateDialog,"onUpdate:modelValue":o[10]||(o[10]=t=>s.calculateDialog=t),position:"left","full-height":""},{default:i(()=>[l(I,{onClose:o[9]||(o[9]=t=>s.calculateDialog=!1),products:s.products},null,8,["products"])]),_:1},8,["modelValue"]),Oe]),_:1})}var et=D(W,[["render",qe]]);export{et as default};
