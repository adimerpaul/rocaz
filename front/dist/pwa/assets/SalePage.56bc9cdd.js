import{_ as O,C as y,D as h,E as I,F as i,H as a,G as l,K as V,ao as r,b9 as D,Q as m,an as p,b3 as C,aq as g,I as c,b1 as z,J as b,ap as P,z as k,bb as q,ba as Q,as as U,au as T,av as B,at as N,ar as E}from"./index.2ab2e5d7.js";import{Q as f,c as G}from"./QMarkupTable.d0352b7c.js";import{Q as F,a as x}from"./QTable.8efc6223.js";import{I as _,Q as M}from"./Imprimir.67e41eb3.js";import{C as L,Q as j,a as H}from"./CalculatePage.291e6bdd.js";import{a as w,Q as J,b as K}from"./QItem.a32369e6.js";import{Q as W}from"./QTooltip.ec45c938.js";import{Q as X}from"./QList.37434aeb.js";import{Q as Y}from"./QSpace.17f696b8.js";import{Q as Z}from"./QForm.3c7ea175.js";import{Q as $}from"./QPage.c98ef323.js";import{C as S}from"./ClosePopup.9f681100.js";import{P as ee}from"./ProductsComponents.a358203c.js";import{h as te}from"./html2pdf.ffac9dcd.js";import"./format.68445a90.js";import"./moment.40bc58bf.js";import"./QScrollObserver.e4841614.js";import"./TouchPan.c6c45f0a.js";import"./Alert.a11260d0.js";import"./QImg.cd0582c2.js";import"./_commonjsHelpers.d2428edb.js";const oe={name:"ProductosPage",components:{CalculatePage:L,ProductsComponents:ee},data(){return{descuento:"",vista:"tabla",calculateDialog:!1,metodoPago:"EFECTIVO",precio:"PRECIO 1",almacenSelected:"Todo",search:"",categories:[{id:"",name:"Selecciona una categor\xEDa"}],loading:!1,categoriSelected:"",ordenes:["Selecciona un orden","Alfab\xE9tico","Producto m\xE1s vendido","Producto menos vendido","Ultimas unidades disponibles"],ordenSelected:"Selecciona un orden",medidas:[],products:[],productsAll:[],saleDialog:!1,client:{nit:"",nombre:""},clients:[],efectivo:""}},mounted(){this.categoriesGet(),this.productsGet(),this.medidasGet(),this.clientsGet()},methods:{clientsGet(){this.$axios.get("clients",{params:{type:"CLIENTE"}}).then(t=>{this.clients=this.clients.concat(t.data)})},addProduct(t){const e=t.producto,d=Math.ceil(t.cantidad);console.log(e),console.log(d);const v=this.$store.productosVenta.find(s=>s.id===e.id);v?v.cantidadVenta+=d:(this.precio==="PRECIO 1"&&(e.precioVenta=e.precio1),this.precio==="PRECIO 2"&&(e.precioVenta=e.precio2),this.precio==="PRECIO 3"&&(e.precioVenta=e.precio3),this.precio==="PRECIO 4"&&(e.precioVenta=e.precio4),this.precio==="PRECIO 5"&&(e.precioVenta=e.precio5),this.precio==="PRECIO 6"&&(e.precioVenta=e.precio6),this.$store.productosVenta.push({id:e.id,nombre:e.nombre,cantidadVenta:d,precioVenta:e.precioVenta,costoUnitario:e.costoUnitario,stock:e.stock,image:e.image}))},cotizacionPdf(){document.getElementById("myElement").classList.remove("hidden"),_.cotizacion(this.$store.productosVenta,this.client,this.total,this.descuento,!1).then(()=>{const e=document.getElementById("myElement"),d={margin:1,filename:"cotizacion.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"portrait"}};te().set(d).from(e).save(),setTimeout(()=>{e.classList.add("hidden")},300)})},cotizacion(){_.cotizacion(this.$store.productosVenta,this.client,this.total,this.descuento)},numero2digitosRedondeado(t){return(Math.round(t*100)/100).toFixed(2)},saleInsert(){this.loading=!0,this.$axios.post("sales",{nit:this.client.nit,nombre:this.client.nombre,telefono:this.client.telefono,direccion:this.client.direccion,comentario:this.client.comentario,total:this.total,metodo:this.metodoPago,almacen:this.almacenSelected,productos:this.$store.productosVenta,descuento:this.descuento}).then(t=>{_.nota(t.data),this.productsGet(),this.$alert.success("Venta realizada")}).finally(()=>{this.loading=!1,this.saleDialog=!1,this.$store.productosVenta=[]})},precioVenta(t){t.precioVenta===""&&(t.precioVenta=1)},cambioNumero(t,e){console.log(t)},removeCantidad(t,e){t.cantidad++,t.cantidadPedida--,t.cantidadVenta>1?t.cantidadVenta=parseInt(t.cantidadVenta)-1:t.cantidadVenta===1&&this.$store.productosVenta.splice(e,1)},addCantidad(t,e){t.cantidad--,t.cantidadPedida++,t.cantidadVenta=parseInt(t.cantidadVenta)+1},deleteProductosVenta(t,e){this.$store.productosVenta.splice(e,1)},redondeo(t){return Math.round(t*100)/100},clickDetalleProducto(t){const e=this.$store.productosVenta.find(d=>d.id===t.id);e?e.cantidadVenta+=1:(this.precio==="PRECIO 1"&&(t.precioVenta=t.precio1),this.precio==="PRECIO 2"&&(t.precioVenta=t.precio2),this.precio==="PRECIO 3"&&(t.precioVenta=t.precio3),this.precio==="PRECIO 4"&&(t.precioVenta=t.precio4),this.precio==="PRECIO 5"&&(t.precioVenta=t.precio5),this.precio==="PRECIO 6"&&(t.precioVenta=t.precio6),this.$store.productosVenta.push({id:t.id,nombre:t.nombre,cantidadVenta:1,precioVenta:t.precioVenta,costoUnitario:t.costoUnitario,stock:t.stock,image:t.image,visible:!0}))},clickSale(){this.saleDialog=!0,this.efectivo="",this.client={nit:"0",nombre:"SN"}},vaciarCanasta(){this.$store.productosVenta=[]},searchProductsOrder(t){t===""&&(this.products=this.productsAll),t==="Alfab\xE9tico"&&(this.products=this.productsAll.sort((e,d)=>e.nombre.localeCompare(d.nombre))),t==="Producto m\xE1s vendido"&&(this.products=this.productsAll.sort((e,d)=>d.cantidadVentas-e.cantidadVentas)),t==="Producto menos vendido"&&(this.products=this.productsAll.sort((e,d)=>e.cantidadVentas+d.cantidadVentas)),t==="Ultimas unidades disponibles"&&(this.products=this.productsAll.sort((e,d)=>e.stock-d.stock))},searchProductsCategory(t){t===""?this.products=this.productsAll:this.products=this.productsAll.filter(e=>e.category_id===t)},medidasGet(){this.$axios.get("medidas").then(t=>{this.medidas=this.medidas.concat(t.data)})},searchProducts(){this.search===""?this.products=this.productsAll:this.products=this.productsAll.filter(t=>t.nombre.toLowerCase().includes(this.search.toLowerCase()))},categoriesGet(){this.$axios.get("categories").then(t=>{this.categories=this.categories.concat(t.data)})},productsGet(){this.loading=!0,this.$axios.get("products").then(t=>{this.loading=!1,this.products=t.data,this.productsAll=t.data})},searchClient(t){this.loading=!0,this.$axios.post("searchClient",{nit:t}).then(e=>{e.data.nombre!==void 0&&(this.client.nombre=e.data.nombre,this.client.telefono=e.data.telefono,this.client.direccion=e.data.direccion)}).finally(()=>{this.loading=!1})}},computed:{Imprimir(){return _},cambio(){const t=parseFloat(this.efectivo===""?0:this.efectivo),e=parseFloat(this.total===""?0:this.total);return Math.round((t-e)*100)/100},total(){const t=this.$store.productosVenta.reduce((e,d)=>e+d.cantidadVenta*d.precioVenta,0);return Math.round(t*100)/100},totalganancia(){return this.$store.productosVenta.reduce((t,e)=>t+(e.cantidadVenta*e.precioVenta-e.costoUnitario)*e.cantidadVenta,0)},columnsProductosVenta(){return[{name:"borrar",align:"center",label:"Borrar",field:"borrar"},{name:"nombre",align:"center",label:"Nombre",field:"nombre"},{name:"cantidadVenta",align:"center",label:"Cantidad",field:"cantidadVenta"}]},ruleNumber(){return[t=>!!t||"Campo requerido",t=>t&&t>0||"Debe ser mayor a 0"]}}},le={class:"row"},ae={class:"col-12 col-md-8"},se={class:"row"},ie={class:"col-12 col-md-3"},ne={class:"col-6 col-md-2 text-right"},de=a("div",{class:"col-6 col-md-7 text-right"},null,-1),ce={class:"col-4 col-md-3"},re={class:"col-8 col-md-3"},ue={class:"col-4 col-md-2"},me={class:"col-12 col-md-2 text-right"},pe={class:"col-12 col-md-2 text-right"},he={class:"col-12"},Ve={class:"col-12 col-md-4"},ge={class:"row"},fe=a("div",{class:"col-6 text-h6 q-pt-xs q-pl-lg"},"Canasta",-1),be={class:"col-6 text-right"},_e={key:0,class:"flex flex-center q-pa-lg"},ve=a("div",{class:"q-pa-lg text-grey text-center noSelect"}," A\xFAn no tienes productos en tu canasta. Haz clic sobre un producto para agregarlo. ",-1),Ce={class:"text-caption",style:{"max-width":"170px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},Pe={class:"text-grey"},xe=a("div",{style:{"font-size":"10px"}},"Bs.",-1),we={class:"text-grey"},ye={class:"text-right text-grey-8 text-bold"},Ie={class:"row"},ke=a("div",{class:"col-7 text-grey"},"Cantidades de referencia",-1),Qe={class:"col-5 text-right"},Ue={class:"col-7 text-grey"},Ee={class:"col-5 text-right text-green"},Se=a("div",{class:"text-h6"},"Realizar venta",-1),Re={class:"row"},Ae={class:"col-6 col-md-3"},Oe={class:"col-12 col-md-3"},De={id:"users"},ze=["value"],qe={class:"col-12 col-md-3"},Te={class:"col-12 col-md-3"},Be={class:"col-12 col-md-12"},Ne={class:"row"},Ge={class:"col-6 col-md-2"},Fe={class:"col-6 col-md-3"},Me={class:"col-6 col-md-2"},Le={class:"col-6 col-md-3"},je={class:"col-6 col-md-2 text-center"},He=a("thead",null,[a("tr",null,[a("th",null,"#"),a("th",null,"Nombre"),a("th",null,"Cantidad"),a("th",null,"Precio"),a("th",null,"Subtotal")])],-1),Je={class:"text-right"},Ke={class:"text-right text-bold"},We={colspan:"2",class:"text-right text-bold"},Xe=a("td",{colspan:"2",class:"text-right text-bold"},"Total",-1),Ye={class:"text-right text-bold"},Ze={class:"row"},$e={class:"col-6"},et={class:"col-6"},tt=a("div",{id:"myElement",class:"hidden"},null,-1);function ot(t,e,d,v,s,n){const R=y("ProductsComponents"),A=y("CalculatePage");return h(),I($,{class:"bg-grey-3 q-pa-xs"},{default:i(()=>[a("div",le,[a("div",ae,[a("div",se,[a("div",ie,[l(r,{modelValue:s.search,"onUpdate:modelValue":[e[0]||(e[0]=o=>s.search=o),n.searchProducts],label:"Buscar",outlined:"",dense:"",class:"bg-white",loading:s.loading},{prepend:i(()=>[l(V,{name:"o_search"})]),_:1},8,["modelValue","onUpdate:modelValue","loading"])]),a("div",ne,[l(D,{"model-value":"vista",label:s.vista,color:"primary",dense:"",modelValue:s.vista,"onUpdate:modelValue":e[1]||(e[1]=o=>s.vista=o),"false-value":"lista","true-value":"tabla"},null,8,["label","modelValue"])]),de,a("div",ce,[l(f,{modelValue:s.categoriSelected,"onUpdate:modelValue":[e[2]||(e[2]=o=>s.categoriSelected=o),n.searchProductsCategory],options:s.categories,label:"Categor\xEDa",outlined:"",dense:"",class:"bg-white","emit-value":"","map-options":"","option-label":o=>o.name,"option-value":o=>o.id},null,8,["modelValue","options","option-label","option-value","onUpdate:modelValue"])]),a("div",re,[l(f,{modelValue:s.ordenSelected,"onUpdate:modelValue":[e[3]||(e[3]=o=>s.ordenSelected=o),n.searchProductsOrder],options:s.ordenes,label:"Ordenar por",outlined:"",dense:"",class:"bg-white","emit-value":""},null,8,["modelValue","options","onUpdate:modelValue"])]),a("div",ue,[l(f,{modelValue:s.almacenSelected,"onUpdate:modelValue":e[4]||(e[4]=o=>s.almacenSelected=o),options:["Todo","Almacen 1","Almacen 2"],label:"Almacen",outlined:"",dense:"",class:"bg-white","emit-value":""},null,8,["modelValue"])]),a("div",me,[l(f,{modelValue:s.precio,"onUpdate:modelValue":e[5]||(e[5]=o=>s.precio=o),options:["PRECIO 1","PRECIO 2","PRECIO 3","PRECIO 4","PRECIO 5","PRECIO 6"],label:"Precio",outlined:"",dense:"",class:"bg-white","emit-value":""},null,8,["modelValue"])]),a("div",pe,[l(m,{label:"Calculos",color:"green",icon:"o_calculate","no-caps":"",rounded:"",class:"bg-white",onClick:e[6]||(e[6]=o=>s.calculateDialog=!0)})]),a("div",he,[l(R,{products:s.products,onClickDetalleProducto:n.clickDetalleProducto,precio:s.precio,almacenSelected:s.almacenSelected,vista:s.vista},null,8,["products","onClickDetalleProducto","precio","almacenSelected","vista"])])])]),a("div",Ve,[l(P,null,{default:i(()=>[l(p,{class:"q-pa-none q-ma-none"},{default:i(()=>[a("div",ge,[fe,a("div",be,[l(m,{class:"text-subtitle1 text-blue-10 text-bold",style:{"text-decoration":"underline"},label:"Vaciar canasta",onClick:n.vaciarCanasta,"no-caps":"",flat:"",outline:""},null,8,["onClick"])])])]),_:1}),l(C),l(p,{class:"q-pa-none q-ma-none"},{default:i(()=>[t.$store.productosVenta.length==0?(h(),g("div",_e,[l(V,{name:"o_shopping_basket",color:"grey",size:"100px"}),ve])):(h(),I(j,{key:1,style:{height:"400px"}},{default:i(()=>[l(F,{dense:"",flat:"",bordered:"","hide-bottom":"","hide-header":"",rows:t.$store.productosVenta,columns:n.columnsProductosVenta,"rows-per-page-options":[0]},{body:i(o=>[l(M,{props:o},{default:i(()=>[l(x,{key:"borrar",props:o,style:{padding:"0px",margin:"0px"},"auto-width":""},{default:i(()=>[l(m,{flat:"",dense:"",onClick:u=>n.deleteProductosVenta(o.row,o.pageIndex),icon:"delete",color:"red",size:"10px",class:"q-pa-none q-ma-none"},null,8,["onClick"])]),_:2},1032,["props"]),l(x,{key:"nombre",props:o,"auto-width":""},{default:i(()=>[a("div",null,[a("div",null,[a("div",Ce,c(o.row.nombre),1),a("div",Pe,"Disponible: "+c(o.row.stock),1),l(r,{modelValue:o.row.precioVenta,"onUpdate:modelValue":[u=>o.row.precioVenta=u,u=>n.precioVenta(o.row)],style:{width:"170px"},class:"super-small",step:"0.01",type:"number",dense:"",outlined:""},{prepend:i(()=>[l(V,{name:"edit",size:"xs"}),xe]),after:i(()=>[l(z,{modelValue:o.row.visible,"onUpdate:modelValue":u=>o.row.visible=u,dense:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["props"]),l(x,{key:"cantidadVenta",props:o},{default:i(()=>[l(r,{dense:"",outlined:"","bottom-slots":"",min:"1",class:"super-small",modelValue:o.row.cantidadVenta,"onUpdate:modelValue":[u=>o.row.cantidadVenta=u,u=>n.cambioNumero(o.row,o.pageIndex)],rules:n.ruleNumber,type:"number","input-class":"text-center",required:""},null,8,["modelValue","onUpdate:modelValue","rules"]),a("div",we,"= Bs "+c(n.redondeo(o.row.cantidadVenta*o.row.precioVenta)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1}))]),_:1}),l(p,null,{default:i(()=>[l(X,{padding:"",bordered:"",dense:"",class:"rounded-borders full-width q-pa-none q-ma-none"},{default:i(()=>[l(H,{dense:"","dense-toggle":"","expand-separator":"",label:"Total"},{header:i(()=>[l(w,null,{default:i(()=>[b(" Total ")]),_:1}),l(w,{side:""},{default:i(()=>[a("div",ye,[a("u",null," Bs "+c(n.total),1)])]),_:1})]),default:i(()=>[l(P,null,{default:i(()=>[l(p,null,{default:i(()=>[a("div",Ie,[ke,a("div",Qe,c(t.$store.productosVenta.length),1),a("div",Ue,[b(" Ganancia "),l(V,{name:"o_info"},{default:i(()=>[l(W,{anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:i(()=>[b(" Para calcular la ganancia correctamente, deber\xE1s cargar el costo unitario de todos los productos desde tu Inventario. ")]),_:1})]),_:1})]),a("div",Ee,c(n.totalganancia)+" Bs",1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(m,{onClick:n.clickSale,class:"full-width","no-caps":"",label:"Confirmar venta",color:t.$store.productosVenta.length==0?"grey":"warning",disable:t.$store.productosVenta.length==0},null,8,["onClick","color","disable"])]),_:1})]),_:1})])]),l(E,{modelValue:s.saleDialog,"onUpdate:modelValue":e[17]||(e[17]=o=>s.saleDialog=o),persistent:""},{default:i(()=>[l(P,{style:{width:"750px","max-width":"90vw"}},{default:i(()=>[l(p,{class:"row items-center q-pb-none"},{default:i(()=>[Se,l(Y),k(l(m,{flat:"",round:"",dense:"",icon:"close"},null,512),[[S]])]),_:1}),l(Z,{onSubmit:q(n.saleInsert,["prevent"])},{default:i(()=>[l(p,null,{default:i(()=>[a("div",Re,[a("div",Ae,[l(r,{outlined:"",dense:"",label:"Numero",required:"","onUpdate:modelValue":[n.searchClient,e[7]||(e[7]=o=>s.client.nit=o)],modelValue:s.client.nit,loading:s.loading,debounce:500},null,8,["onUpdate:modelValue","modelValue","loading"])]),a("div",Oe,[l(r,{outlined:"",dense:"",label:"Nombre Razon Social",required:"",modelValue:s.client.nombre,"onUpdate:modelValue":e[8]||(e[8]=o=>s.client.nombre=o),list:"users"},null,8,["modelValue"]),a("datalist",De,[(h(!0),g(U,null,Q(s.clients,o=>(h(),g("option",{value:o.nombre,key:o.id},null,8,ze))),128))])]),a("div",qe,[l(r,{outlined:"",dense:"",label:"Telefono",modelValue:s.client.telefono,"onUpdate:modelValue":e[9]||(e[9]=o=>s.client.telefono=o)},null,8,["modelValue"])]),a("div",Te,[l(r,{outlined:"",dense:"",label:"Direccion",modelValue:s.client.direccion,"onUpdate:modelValue":e[10]||(e[10]=o=>s.client.direccion=o)},null,8,["modelValue"])]),a("div",Be,[l(r,{outlined:"",dense:"",label:"Comentario",modelValue:s.client.comentario,"onUpdate:modelValue":e[11]||(e[11]=o=>s.client.comentario=o),style:{"text-transform":"uppercase"},type:"textarea"},null,8,["modelValue"])])])]),_:1}),l(C),l(p,null,{default:i(()=>[a("div",Ne,[a("div",Ge,[l(r,{outlined:"",dense:"",label:"TOTAL A PAGAR:",readonly:"",modelValue:n.total,"onUpdate:modelValue":e[12]||(e[12]=o=>n.total=o)},null,8,["modelValue"])]),a("div",Fe,[l(r,{outlined:"",dense:"",label:"EFECTIVO BS.",modelValue:s.efectivo,"onUpdate:modelValue":e[13]||(e[13]=o=>s.efectivo=o)},null,8,["modelValue"])]),a("div",Me,[l(r,{outlined:"",dense:"",label:"CAMBIO:",readonly:"",modelValue:n.cambio,"onUpdate:modelValue":e[14]||(e[14]=o=>n.cambio=o)},null,8,["modelValue"])]),a("div",Le,[l(f,{dense:"",outlined:"",modelValue:s.metodoPago,"onUpdate:modelValue":e[15]||(e[15]=o=>s.metodoPago=o),label:"Metodo de pago",options:t.$metodos,hint:"Metodo de pago del gasto"},{prepend:i(()=>[l(V,{name:"o_payment"})]),option:i(o=>[l(J,T(B(o.itemProps)),{default:i(()=>[l(w,{class:N(o.opt=="CREDITO"?"bg-red":"")},{default:i(()=>[l(K,null,{default:i(()=>[b(c(o.opt),1)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1040)]),_:1},8,["modelValue","options"])]),a("div",je,[l(m,{onClick:n.cotizacion,"no-caps":"",label:"Cotizar",color:"indigo",icon:"print",size:"10px"},null,8,["onClick"]),l(m,{onClick:n.cotizacionPdf,"no-caps":"",label:"Cotizar PDF",color:"indigo",icon:"print",size:"10px"},null,8,["onClick"])])])]),_:1}),l(G,{dense:"","wrap-cells":""},{default:i(()=>[He,a("tbody",null,[(h(!0),g(U,null,Q(t.$store.productosVenta,(o,u)=>(h(),g("tr",{key:o.id},[a("td",null,c(u+1),1),a("td",null,c(o.nombre),1),a("td",null,c(o.cantidadVenta),1),a("td",Je,c(n.numero2digitosRedondeado(o.precioVenta)),1),a("td",Ke,c(n.numero2digitosRedondeado(o.cantidadVenta*o.precioVenta))+" Bs.",1)]))),128)),a("tr",null,[a("td",We,[l(r,{label:"Descuento",modelValue:s.descuento,"onUpdate:modelValue":e[16]||(e[16]=o=>s.descuento=o),dense:"",outlined:""},null,8,["modelValue"])]),Xe,a("td",Ye,c(n.numero2digitosRedondeado(n.total-s.descuento))+" Bs.",1)])])]),_:1}),l(C),l(p,null,{default:i(()=>[a("div",Ze,[a("div",$e,[l(m,{type:"submit",class:"full-width",icon:"o_add_circle",label:"Realizar venta",loading:s.loading,"no-caps":"",color:"green"},null,8,["loading"])]),a("div",et,[k(l(m,{class:"full-width",icon:"undo",label:"Atras","no-caps":"",color:"red",loading:s.loading},null,8,["loading"]),[[S]])])])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:s.calculateDialog,"onUpdate:modelValue":e[19]||(e[19]=o=>s.calculateDialog=o),position:"left","full-height":""},{default:i(()=>[l(A,{onClose:e[18]||(e[18]=o=>s.calculateDialog=!1),productsAll:s.products,onAddProduct:n.addProduct},null,8,["productsAll","onAddProduct"])]),_:1},8,["modelValue"]),tt]),_:1})}var wt=O(oe,[["render",ot]]);export{wt as default};
