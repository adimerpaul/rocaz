import{_ as N,G as d,H as v,I as a,J as t,C,Q as c,aq as I,K as r,ar as _,as as Q,F as S,at as f,au as G,av as U,O as A,P as h,M as b,L as p,aw as D,ax as q,ay as B,az as F}from"./index.dd2f74c0.js";import{Q as k}from"./QSelect.db3f2d3f.js";import{Q as V}from"./QTooltip.dc30be3b.js";import{Q as y,a as z,b as P}from"./QItem.a8a62a25.js";import{Q as L}from"./QBtnDropdown.f3ffad61.js";import{Q as Y,a as g}from"./QTable.08ef5c16.js";import{Q as M}from"./format.441614fa.js";import{I as O,Q as j}from"./Imprimir.55edf611.js";import{Q as H}from"./QPage.79b26ac2.js";import{Q as R}from"./QSpace.bbedad6f.js";import{C as x}from"./ClosePopup.7ce8b806.js";import{h as W}from"./html2pdf.af0362c8.js";import{h as E}from"./moment.40bc58bf.js";import{C as J}from"./CardComponent.9ceb3e89.js";import{Q as K}from"./QForm.19d5d612.js";import{E as $}from"./Excel.0b4494da.js";import"./QList.88966542.js";import"./QMarkupTable.dab57ddd.js";import"./_commonjsHelpers.d2428edb.js";const X={data(){return{provider:[],gasto:{monto:"",concepto:"",metodo:"EFECTIVO",client_id:""},loading:!1}},mounted(){this.proveedoresGet()},methods:{proveedoresGet(){this.$axios.get("proveedores").then(l=>{this.provider=l.data})},saveSale(){this.loading=!0,this.$axios.post("registrarGasto",this.gasto).then(l=>{this.$emit("gastoCreated",l.data),this.$alert.success("Gasto registrado")}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},proveedorCreateSimple(){this.$q.dialog({title:"Registrar proveedor",message:"Ingrese el nombre del proveedor",prompt:{model:"",type:"text"},cancel:!0,persistent:!0}).onOk(l=>{this.$axios.post("proveedorCreateSimple",{nombre:l}).then(e=>{this.provider.push(e.data),this.gasto.client_id=e.data.id}).catch(e=>{this.$alert.error(e.response.data.message)})})}}},Z=r("div",{class:"text-subtitle2 text-bold text-grey"}," Registrar gasto ",-1),ee={class:"row"},oe={class:"col-12"},te={class:"col-12"},le={class:"col-12"},ae={class:"col-12"},se={class:"col-12"};function ne(l,e,n,u,s,i){return d(),v(Q,{style:{width:"500px","max-width":"80vw"}},{default:a(()=>[t(I,{class:"row items-center q-pb-none"},{default:a(()=>[Z,t(R),C(t(c,{icon:"o_highlight_off",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),t(I,null,{default:a(()=>[t(K,{onSubmit:i.saveSale},{default:a(()=>[r("div",ee,[r("div",oe,[t(_,{outlined:"",dense:"",modelValue:s.gasto.monto,"onUpdate:modelValue":e[0]||(e[0]=m=>s.gasto.monto=m),label:"Monto *",type:"number",step:"0.1",rules:[m=>!!m||"Campo requerido"]},null,8,["modelValue","rules"])]),r("div",te,[t(_,{outlined:"",dense:"",hint:"",modelValue:s.gasto.concepto,"onUpdate:modelValue":e[1]||(e[1]=m=>s.gasto.concepto=m),label:"Descripci\xF3n"},null,8,["modelValue"])]),r("div",le,[t(k,{outlined:"",dense:"",hint:"",modelValue:s.gasto.metodo,"onUpdate:modelValue":e[2]||(e[2]=m=>s.gasto.metodo=m),options:l.$metodos,label:"M\xE9todo de pago"},null,8,["modelValue","options"])]),r("div",ae,[t(k,{outlined:"",dense:"",hint:"",modelValue:s.gasto.client_id,"onUpdate:modelValue":e[3]||(e[3]=m=>s.gasto.client_id=m),options:s.provider,label:"Proveedor","emit-value":"","map-options":"","option-value":"id","option-label":"nombre","use-input":""},{after:a(()=>[t(c,{flat:"",dense:"",icon:"add_circle_outline",onClick:i.proveedorCreateSimple,color:"green"},null,8,["onClick"])]),_:1},8,["modelValue","options"])]),r("div",se,[t(c,{type:"submit",label:"Guardar",color:"red-7",class:"full-width","no-caps":"",rounded:"",loading:s.loading},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var re=N(X,[["render",ne]]);const ie={name:"IndexPage",components:{DialogGasto:re,CardComponent:J},data(){return{metodo:"Todos",gastoDialog:!1,fechaInicioSemana:E().startOf("isoWeek").format("YYYY-MM-DD"),fechaFinSemana:E().endOf("isoWeek").format("YYYY-MM-DD"),concepto:"",columns:[{name:"opcion",label:"Opcion",align:"left",field:"opcion"},{name:"proveedorcliente",label:"Proveedor / cliente",align:"left",field:"proveedor / cliente",sortable:!0},{name:"montoTotal",label:"Monto total",align:"left",field:"montoTotal",sortable:!0},{name:"fechayhora",label:"Fecha y hora",align:"left",field:"fechayhora",sortable:!0},{name:"concepto",label:"Concepto",align:"left",field:"concepto",sortable:!0},{name:"comentario",label:"Comentario",align:"left",field:"comentario",sortable:!0},{name:"egresoingreso",label:"Egreso / ingreso",align:"left",field:"egreso / ingreso",sortable:!0},{name:"metodo",label:"Metodo",align:"left",field:"metodo",sortable:!0},{name:"user",label:"Usuario",align:"left",field:l=>l.user.name,sortable:!0},{name:"lugar",label:"lugar",align:"left",field:l=>l.user.lugar,sortable:!0}],sales:[],loading:!1,filter:"",users:[],user:0,comentarioMetodoDialog:!1,sale:{}}},mounted(){this.usersGet(),this.salesGet()},methods:{updateSaleComentarioEfectivo(){this.loading=!0,this.$axios.post("updateSaleComentarioEfectivo",this.sale).then(l=>{this.salesGet(),this.comentarioMetodoDialog=!1}).catch(l=>{console.log(l)})},modificarComentarioMetodo(l){this.comentarioMetodoDialog=!0,this.sale={...l}},usersGet(){this.users=[{label:"Todos",value:0}],this.$axios.get("usuarios").then(l=>{l.data.forEach(e=>{this.users.push({label:e.name,value:e.id})})}).catch(l=>{console.log(l)})},exportar(){const l=[{sheet:"Adults",columns:[{label:"Proveedor / cliente",value:"name"},{label:"Monto total",value:"total"},{label:"Fecha y hora",value:"fecha_emision"},{label:"Concepto",value:"concepto"},{label:"Comentario",value:"comentario"},{label:"Egreso / ingreso",value:"tipo_venta"},{label:"Usuario",value:"user.name"},{label:"Lugar",value:"lugar"}],content:this.sales}];$.export(l,"ventas")},reimprimirNota(l){O.nota(l).then(e=>{})},descargarDpf(l){document.getElementById("myElement").classList.remove("hidden"),O.nota(l,!1).then(n=>{const u=document.getElementById("myElement"),s={margin:1,filename:l.concepto+".pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"portrait"}};W().set(s).from(u).save(),setTimeout(()=>{u.classList.add("hidden")},300)})},saleAnular(l){this.$q.dialog({title:"Anular venta",message:"\xBFEst\xE1 seguro de anular la venta?",persistent:!0,ok:{label:"Si",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(()=>{this.$axios.post("saleAnular",{id:l}).then(e=>{this.salesGet()}).catch(e=>{console.log(e)})})},gastoCreated(l){this.sales.unshift(l),this.gastoDialog=!1},salesGet(l="todo"){this.loading=!0,this.$axios.get("sales",{params:{fechaInicioSemana:this.fechaInicioSemana,fechaFinSemana:this.fechaFinSemana,concepto:this.concepto,user:this.user,metodo:this.metodo,type:l}}).then(e=>{this.sales=e.data,console.log(e.data)}).catch(e=>{console.log(e)}).finally(()=>{this.loading=!1})}},computed:{ganancia(){const l=this.sales.reduce((n,u)=>u.estado!=="ANULADO"?u.tipo_venta==="INGRESO"?n+(u.total-u.descuento):n-(u.total-u.descuento):n,0),e=this.sales.reduce((n,u)=>u.tipo_venta==="INGRESO"&&u.estado!=="ANULADO"?n+u.descuento:n,0);return Math.round((l-e)*100)/100},balance(){const l=this.sales.reduce((e,n)=>n.estado!=="ANULADO"?n.tipo_venta==="INGRESO"?e+(n.total-n.descuento):e-(n.total-n.descuento):e,0);return Math.round(l*100)/100},ingreso(){const l=this.sales.reduce((e,n)=>n.tipo_venta==="INGRESO"&&n.estado!=="ANULADO"?e+(n.total-n.descuento):e,0);return Math.round(l*100)/100},gasto(){const l=this.sales.reduce((e,n)=>n.tipo_venta==="EGRESO"&&n.estado!=="ANULADO"?e+n.total:e,0);return Math.round(l*100)/100}}},de={class:"row"},ue={class:"col-6 col-md-2 q-pa-xs"},ce={class:"col-6 col-md-2 q-pa-xs"},me={class:"col-12 col-md-2 q-pa-xs"},pe={class:"col-12 col-md-2 q-pa-xs"},ge={class:"col-12 col-md-2 q-pa-xs"},fe={class:"col-12 col-md-2 text-right"},he={key:0,class:"col-12 col-md-3 q-pa-xs"},ve={key:1,class:"col-12 col-md-3 q-pa-xs"},be={key:2,class:"col-12 col-md-3 q-pa-xs"},_e={key:3,class:"col-12 col-md-3 q-pa-xs"},we={class:"col-12"},ye={key:1},Ce={key:0,class:"text-grey"},xe={class:"text-black"},ke={key:1},De={style:{"padding-left":"15px"}},Ve={class:"q-ml-xs",style:{width:"200px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},Ie={class:"",style:{width:"200px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},Se=r("div",{class:"text-h6"},"Modificar Credito",-1),Ge=r("div",{id:"myElement",class:"hidden"},null,-1);function Ae(l,e,n,u,s,i){const m=S("CardComponent"),T=S("DialogGasto");return d(),f(U,null,[t(H,{class:"q-pa-xs bg-grey-3"},{default:a(()=>[r("div",de,[r("div",ue,[t(_,{modelValue:s.fechaInicioSemana,"onUpdate:modelValue":[e[0]||(e[0]=o=>s.fechaInicioSemana=o),e[1]||(e[1]=o=>i.salesGet("todo"))],label:"Fecha inicio",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue"])]),r("div",ce,[t(_,{modelValue:s.fechaFinSemana,"onUpdate:modelValue":[e[2]||(e[2]=o=>s.fechaFinSemana=o),e[3]||(e[3]=o=>i.salesGet("todo"))],label:"Fecha fin",dense:"",outlined:"",type:"date",class:"bg-white"},null,8,["modelValue"])]),r("div",me,[t(_,{modelValue:s.concepto,"onUpdate:modelValue":[e[4]||(e[4]=o=>s.concepto=o),e[5]||(e[5]=o=>i.salesGet("todo"))],label:"Buscar por concepto",dense:"",outlined:"",class:"bg-white",debounce:"300",clearable:"",placeholder:"Buscar por concepto"},{prepend:a(()=>[t(A,{name:"search"})]),_:1},8,["modelValue"])]),r("div",pe,[l.$store.user.type=="ADMINISTRADOR"?(d(),v(k,{key:0,modelValue:s.user,"onUpdate:modelValue":[e[6]||(e[6]=o=>s.user=o),e[7]||(e[7]=o=>i.salesGet("todo"))],label:"Usuario",dense:"",outlined:"",class:"bg-white",options:s.users,"map-options":"","emit-value":""},null,8,["modelValue","options"])):h("",!0)]),r("div",ge,[l.$store.user.type=="ADMINISTRADOR"?(d(),v(k,{key:0,modelValue:s.metodo,"onUpdate:modelValue":[e[8]||(e[8]=o=>s.metodo=o),e[9]||(e[9]=o=>i.salesGet("todo"))],label:"Metodo",dense:"",outlined:"",class:"bg-white",options:["Todos",...l.$metodos]},null,8,["modelValue","options"])):h("",!0)]),r("div",fe,[t(c,{class:"",flat:"",dense:"",label:"Exportar",color:"primary",icon:"get_app","no-caps":"",rounded:"",onClick:i.exportar,size:"10px"},null,8,["onClick"]),t(c,{dense:"",label:"Nuevo Gasto",color:"red",icon:"add_circle_outline","no-caps":"",rounded:"",onClick:e[10]||(e[10]=o=>s.gastoDialog=!0)})]),l.$store.user.type=="ADMINISTRADOR"?(d(),f("div",he,[t(m,{class:"cursor-pointer",monto:i.ganancia,color:"blue",title:"Ganancia",icono:"o_trending_up",onClick:e[11]||(e[11]=o=>i.salesGet("todo"))},null,8,["monto"])])):h("",!0),l.$store.user.type=="ADMINISTRADOR"?(d(),f("div",ve,[t(m,{class:"cursor-pointer",monto:i.balance,color:"grey",title:"Balance",icono:"o_trending_up",onClick:e[12]||(e[12]=o=>i.salesGet("todo"))},null,8,["monto"])])):h("",!0),l.$store.user.type=="ADMINISTRADOR"?(d(),f("div",be,[t(m,{class:"cursor-pointer",monto:i.ingreso,color:"green",title:"Ventas",icono:"o_trending_up",onClick:e[13]||(e[13]=o=>i.salesGet("ingreso"))},null,8,["monto"])])):h("",!0),l.$store.user.type=="ADMINISTRADOR"?(d(),f("div",_e,[t(m,{class:"cursor-pointer",monto:i.gasto,color:"red",title:"Gastos",icono:"o_trending_down",onClick:e[14]||(e[14]=o=>i.salesGet("egreso"))},null,8,["monto"])])):h("",!0),r("div",we,[t(Y,{columns:s.columns,rows:s.sales,dense:"","rows-per-page-options":[0],filter:s.filter,loading:s.loading,"wrap-cells":"","no-data-label":"No hay ventas","no-results-label":"No hay ventas"},{"top-right":a(()=>[t(_,{outlined:"",modelValue:s.filter,"onUpdate:modelValue":e[15]||(e[15]=o=>s.filter=o),debounce:"300",placeholder:"Buscar",dense:""},{append:a(()=>[t(c,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue"])]),body:a(o=>[t(j,{props:o},{default:a(()=>[t(g,{key:"opcion",props:o,"auto-width":""},{default:a(()=>[o.row.estado=="ACTIVO"?(d(),v(L,{key:0,dense:"",icon:"more_vert",align:"right",label:"Opciones","no-caps":"",color:o.row.tipo_venta=="INGRESO"?"green-9":"red-9",size:"10px"},{default:a(()=>[C((d(),v(y,{clickable:"",class:"text-center"},{default:a(()=>[t(c,{dense:"",label:"Anular",color:"red-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"o_highlight_off",onClick:w=>i.saleAnular(o.row.id)},{default:a(()=>[t(V,null,{default:a(()=>[b("Anular venta")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[x]]),C((d(),v(y,{clickable:"",class:"text-center"},{default:a(()=>[t(c,{dense:"",label:"Imprimir",color:"green-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"print",onClick:w=>i.reimprimirNota(o.row)},{default:a(()=>[t(V,null,{default:a(()=>[b("Imprimir nota")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[x]]),C((d(),v(y,{clickable:"",class:"text-center"},{default:a(()=>[t(c,{dense:"",label:"Descargar",color:"blue-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"get_app",onClick:w=>i.descargarDpf(o.row)},{default:a(()=>[t(V,null,{default:a(()=>[b("Descargar nota")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[x]]),C((d(),v(y,{clickable:"",class:"text-center"},{default:a(()=>[t(c,{dense:"",label:"Comentario Credito",color:"orange-4",size:"10px",class:"full-width","no-caps":"","no-wrap":"",icon:"o_edit",onClick:w=>i.modificarComentarioMetodo(o.row)},{default:a(()=>[t(V,null,{default:a(()=>[b("Comentario Credito")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[x]])]),_:2},1032,["color"])):(d(),f("div",ye,[t(c,{dense:"",label:"Anulado",color:"grey-4",size:"10px","no-caps":"","no-wrap":"",icon:"o_highlight_off"})]))]),_:2},1032,["props"]),t(g,{key:"proveedorcliente",props:o},{default:a(()=>[o.row.client?(d(),f("div",Ce,p(o.row.name==null?o.row.client.id==28?"SN":o.row.client.nombre:o.row.name),1)):h("",!0)]),_:2},1032,["props"]),t(g,{key:"montoTotal",props:o,style:{"min-width":"120px"}},{default:a(()=>[o.row.descuento>0?(d(),f("span",{key:0,class:D(`text-${o.row.descuento>0?"red":"green"}`)},p(o.row.descuento)+"Bs - ",3)):h("",!0),r("span",xe,p(o.row.total-o.row.descuento)+"Bs",1),l.$store.user.type=="ADMINISTRADOR"?(d(),f("span",ke,[b(" / "),r("span",{class:D(`text-${o.row.tipo_venta=="INGRESO"?"green":"red"}`)},p(o.row.ganancia)+"Bs",3)])):h("",!0)]),_:2},1032,["props"]),t(g,{key:"fechayhora",props:o,style:{"min-width":"150px"}},{default:a(()=>[b(p(l.$filters.dateDmYHis(o.row.fecha_emision)),1)]),_:2},1032,["props"]),t(g,{key:"concepto",props:o,class:""},{default:a(()=>[r("div",null,[t(c,{icon:"o_local_atm",size:"15px",color:`${o.row.tipo_venta=="INGRESO"?"green":"red"}-7`,class:D(`bg-${o.row.tipo_venta=="INGRESO"?"green":"red"}-2`),dense:"",flat:"",style:{padding:"0px",margin:"0px","border-radius":"0px",position:"absolute",top:"5px",left:"0px"}},null,8,["color","class"]),r("div",De,[r("div",Ve,p(o.row.concepto),1)])])]),_:2},1032,["props"]),t(g,{key:"comentario",props:o},{default:a(()=>[r("div",Ie,p(o.row.comentario),1)]),_:2},1032,["props"]),t(g,{key:"egresoingreso",props:o},{default:a(()=>[t(M,{color:`${o.row.tipo_venta=="INGRESO"?"green":"red"}-5`,"text-color":"white",dense:"",flat:"",label:o.row.tipo_venta},null,8,["color","label"])]),_:2},1032,["props"]),t(g,{key:"metodo",props:o},{default:a(()=>[t(M,{color:`${o.row.metodo=="EFECTIVO"?"blue":"orange"}-5`,"text-color":"white",dense:"",flat:"",label:o.row.metodo},null,8,["color","label"])]),_:2},1032,["props"]),t(g,{key:"user",props:o},{default:a(()=>{var w;return[r("p",null,p((w=o.row.user)==null?void 0:w.name),1)]}),_:2},1032,["props"]),t(g,{key:"lugar",props:o},{default:a(()=>[r("p",null,p(o.row.lugar),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["columns","rows","filter","loading"])])])]),_:1}),t(G,{modelValue:s.gastoDialog,"onUpdate:modelValue":e[16]||(e[16]=o=>s.gastoDialog=o),position:"right",maximized:""},{default:a(()=>[t(T,{onGastoCreated:i.gastoCreated},null,8,["onGastoCreated"])]),_:1},8,["modelValue"]),t(G,{modelValue:s.comentarioMetodoDialog,"onUpdate:modelValue":e[21]||(e[21]=o=>s.comentarioMetodoDialog=o)},{default:a(()=>[t(Q,{style:{width:"400px"}},{default:a(()=>[t(I,{class:"row items-center q-pb-none"},{default:a(()=>[Se,t(R),t(c,{flat:"",round:"",dense:"",icon:"close",onClick:e[17]||(e[17]=o=>s.comentarioMetodoDialog=!1)})]),_:1}),t(I,null,{default:a(()=>[t(_,{modelValue:s.sale.comentario,"onUpdate:modelValue":e[18]||(e[18]=o=>s.sale.comentario=o),label:"Comentario",outlined:"",dense:"",type:"textarea"},null,8,["modelValue"]),t(k,{dense:"",outlined:"",modelValue:s.sale.metodo,"onUpdate:modelValue":e[19]||(e[19]=o=>s.sale.metodo=o),label:"Metodo de pago",options:l.$metodos,hint:"Metodo de pago del gasto"},{prepend:a(()=>[t(A,{name:"o_payment"})]),option:a(o=>[t(y,q(B(o.itemProps)),{default:a(()=>[t(z,{class:D(o.opt=="CREDITO"?"bg-red text-white":"")},{default:a(()=>[t(P,null,{default:a(()=>[b(p(o.opt),1)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1040)]),_:1},8,["modelValue","options"]),t(F,{align:"right"},{default:a(()=>[t(c,{label:"Cancelar",color:"red",onClick:e[20]||(e[20]=o=>s.comentarioMetodoDialog=!1),loading:s.loading},null,8,["loading"]),t(c,{label:"Guardar",color:"green",onClick:i.updateSaleComentarioEfectivo,loading:s.loading},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),Ge],64)}var Ke=N(ie,[["render",Ae]]);export{Ke as default};
